/*
* CanJS - 1.1.3 (2012-12-11)
* http://canjs.us/
* Copyright (c) 2012 Bitovi
* Licensed MIT
*/

/**
   * Copyright (c) 2011 Felix Gnass [fgnass at neteye dot de]
   * Licensed under the MIT license
   */

/*
* jQuery++ - 1.0.0 (2012-11-23)
* http://jquerypp.com
* Copyright (c) 2012 Bitovi
* Licensed MIT
*/

define("can/util/can",[],function(){var e=window.can||{};if(typeof GLOBALCAN=="undefined"||GLOBALCAN!==!1)window.can=e;return e.isDeferred=function(e){var t=this.isFunction;return e&&t(e.then)&&t(e.pipe)},e}),define("can/util/array/each",["can/util/can"],function(e){return e.each=function(e,t,n){var r=0,i;if(e)if(typeof e.length=="number"&&e.pop){e.attr&&e.attr("length");for(i=e.length;r<i;r++)if(t.call(n||e[r],e[r],r,e)===!1)break}else if(e.hasOwnProperty)for(i in e)if(e.hasOwnProperty(i)&&t.call(n||e[i],e[i],i,e)===!1)break;return e},e}),define("can/util/jquery",["jquery","can/util/can","can/util/array/each"],function(e,t){e.extend(t,e,{trigger:function(t,n,r){t.trigger?t.trigger(n,r):e.event.trigger(n,r,t,!0)},addEvent:function(t,n){return e([this]).bind(t,n),this},removeEvent:function(t,n){return e([this]).unbind(t,n),this},buildFragment:function(t,n){var r=e.buildFragment([t],e(n));return r.cacheable?e.clone(r.fragment):r.fragment},$:e,each:t.each}),e.each(["bind","unbind","undelegate","delegate"],function(n,r){t[r]=function(){var t=this[r]?this:e([this]);return t[r].apply(t,arguments),this}}),e.each(["append","filter","addClass","remove","data","get"],function(e,n){t[n]=function(e){return e[n].apply(e,t.makeArray(arguments).slice(1))}});var n=e.cleanData;return e.cleanData=function(r){e.each(r,function(e,n){n&&t.trigger(n,"destroyed",[],!1)}),n(r)},t}),define("can/util/library",["can/util/jquery"],function(e){return e}),define("can/view",["can/util/library"],function(e){var t=e.isFunction,n=e.makeArray,r=1,i=e.view=function(n,r,s,o){t(s)&&(o=s,s=undefined);var u=function(e){return i.frag(e)},a=t(o)?function(e){o(u(e))}:null,f=i.render(n,r,s,a);return t(f)?f:e.isDeferred(f)?f.pipe(u):u(f)};e.extend(i,{frag:function(e,t){return i.hookup(i.fragment(e),t)},fragment:function(t){var n=e.buildFragment(t,document.body);return n.childNodes.length||n.appendChild(document.createTextNode("")),n},toId:function(t){return e.map(t.toString().split(/\/|\./g),function(e){if(e)return e}).join("_")},hookup:function(t,n){var r=[],s,o;return e.each(t.childNodes?e.makeArray(t.childNodes):t,function(t){t.nodeType===1&&(r.push(t),r.push.apply(r,e.makeArray(t.getElementsByTagName("*"))))}),e.each(r,function(e){e.getAttribute&&(s=e.getAttribute("data-view-id"))&&(o=i.hookups[s])&&(o(e,n,s),delete i.hookups[s],e.removeAttribute("data-view-id"))}),t},hookups:{},hook:function(e){return i.hookups[++r]=e," data-view-id='"+r+"'"},cached:{},cachedRenderers:{},cache:!0,register:function(e){this.types["."+e.suffix]=e},types:{},ext:".ejs",registerScript:function(){},preload:function(){},render:function(r,s,f,l){t(f)&&(l=f,f=undefined);var c=u(s);if(c.length){var h=new e.Deferred,p=e.extend({},s);return c.push(o(r,!0)),e.when.apply(e,c).then(function(t){var r=n(arguments),i=r.pop(),o;if(e.isDeferred(s))p=a(t);else for(var u in s)e.isDeferred(s[u])&&(p[u]=a(r.shift()));o=i(p,f),h.resolve(o,p),l&&l(o,p)}),h}var d,v=t(l),h=o(r,v);if(v)d=h,h.then(function(e){l(s?e(s,f):e)});else{if(h.state()==="resolved"&&h.__view_id){var m=i.cachedRenderers[h.__view_id];return s?m(s,f):m}h.then(function(e){d=s?e(s,f):e})}return d},registerView:function(t,n,r,s){var o=(r||i.types[i.ext]).renderer(t,n);return s=s||new e.Deferred,i.cache&&(i.cached[t]=s,s.__view_id=t,i.cachedRenderers[t]=o),s.resolve(o)}});var s=function(e,t){if(!e.length)throw"can.view: No template or empty template:"+t},o=function(t,n){var r=t.match(/\.[\w\d]+$/),o,u,a,f;t.match(/^#/)&&(t=t.substr(1));if(u=document.getElementById(t))r="."+u.type.match(/\/(x\-)?(.+)/)[2];!r&&!i.cached[t]&&(t+=r=i.ext),e.isArray(r)&&(r=r[0]),a=i.toId(t);if(t.match(/^\/\//)){var l=t.substr(2);t=window.steal?steal.config().root.mapJoin(l):l}o=i.types[r];if(i.cached[a])return i.cached[a];if(u)return i.registerView(a,u.innerHTML,o);var c=new e.Deferred;return e.ajax({async:n,url:t,dataType:"text",error:function(e){s("",t),c.reject(e)},success:function(e){s(e,t),i.registerView(a,e,o,c)}}),c},u=function(t){var n=[];if(e.isDeferred(t))return[t];for(var r in t)e.isDeferred(t[r])&&n.push(t[r]);return n},a=function(t){return e.isArray(t)&&t[1]==="success"?t[0]:t};return e.extend(i,{register:function(t){this.types["."+t.suffix]=t,i[t.suffix]=function(n,r){if(!r){var s=function(){return i.frag(s.render.apply(this,arguments))};return s.render=function(){var e=t.renderer(null,n);return e.apply(e,arguments)},s}return i.preload(n,t.renderer(n,r)),e.view(n)}},registerScript:function(e,t,n){return"can.view.preload('"+t+"',"+i.types["."+e].script(t,n)+");"},preload:function(t,n){return i.cached[t]=(new e.Deferred).resolve(function(e,t){return n.call(e,e,t)}),function(){return i.frag(n.apply(this,arguments))}}}),e}),define("can/util/string",["can/util/library"],function(e){var t=/_|-/,n=/\=\=/,r=/([A-Z]+)([A-Z][a-z])/g,i=/([a-z\d])([A-Z])/g,s=/([a-z\d])([A-Z])/g,o=/\{([^\}]+)\}/g,u=/"/g,a=/'/g,f=function(e,t,n){return t in e?e[t]:n&&(e[t]={})},l=function(e){return/^f|^o/.test(typeof e)};return e.extend(e,{esc:function(e){var t=e===null||e===undefined||isNaN(e)&&""+e=="NaN";return(""+(t?"":e)).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(u,"&#34;").replace(a,"&#39;")},getObject:function(t,n,r){var i=t?t.split("."):[],s=i.length,o,u=0,a,c;n=e.isArray(n)?n:[n||window];if(!s)return n[0];while(n[u]){o=n[u];for(c=0;c<s-1&&l(o);c++)o=f(o,i[c],r);if(l(o)){a=f(o,i[c],r);if(a!==undefined)return r===!1&&delete o[i[c]],a}u++}},capitalize:function(e,t){return e.charAt(0).toUpperCase()+e.slice(1)},underscore:function(e){return e.replace(n,"/").replace(r,"$1_$2").replace(i,"$1_$2").replace(s,"_").toLowerCase()},sub:function(t,n,r){var i=[];return i.push(t.replace(o,function(t,s){var o=e.getObject(s,n,r===undefined?r:!r);return o===undefined?(i=null,""):l(o)&&i?(i.push(o),""):""+o})),i===null?i:i.length<=1?i[0]:i},replacer:o,undHash:t}),e}),define("can/observe/compute",["can/util/library"],function(e){var t=function(t,n){var r;e.Observe&&(r=e.Observe.__reading,e.Observe.__reading=function(e,t){i.push({obj:e,attr:t})});var i=[],s=t.call(n);return e.Observe&&(e.Observe.__reading=r),{value:s,observed:i}},n=function(n,r,i){var s={},o=!0,u={value:undefined,teardown:function(){for(var e in s){var t=s[e];t.observe.obj.unbind(t.observe.attr,f),delete s[e]}}},a,f=function(e){if(e.batchNum===undefined||e.batchNum!==a){var t=u.value,n=l();u.value=n,n!==t&&i(n,t),a=a=e.batchNum}},l=function(){var i=t(n,r),u=i.observed,a=i.value;o=!o,e.each(u,function(e){s[e.obj._cid+"|"+e.attr]?s[e.obj._cid+"|"+e.attr].matched=o:(s[e.obj._cid+"|"+e.attr]={matched:o,observe:e},e.obj.bind(e.attr,f))});for(var l in s){var c=s[l];c.matched!==o&&(c.observe.obj.unbind(c.observe.attr,f),delete s[l])}return a};return u.value=l(),u.isListening=!e.isEmptyObject(s),u};return e.compute=function(t,r){if(t&&t.isComputed)return t;var i,s=0,o,u=!0;return typeof t=="function"?o=function(n){return n===undefined?i?(s&&e.Observe.__reading&&e.Observe.__reading(o,"change"),i.value):t.call(r||this):t.apply(r||this,arguments)}:(o=function(n){if(n===undefined)return e.Observe.__reading&&e.Observe.__reading(o,"change"),t;var r=t;return t=n,r!==n&&e.Observe.triggerBatch(o,"change",[n,r]),n},u=!1),o.isComputed=!0,o.bind=function(a,f){e.addEvent.apply(o,arguments),s===0&&u&&(i=n(t,r||this,function(t,n){e.Observe.triggerBatch(o,"change",[t,n])})),s++},o.unbind=function(t,n){e.removeEvent.apply(o,arguments),s--,s===0&&u&&i.teardown()},o},e.compute.binder=n,e.compute}),define("can/view/scanner",["can/view"],function(can){var newLine=/(\r|\n)+/g,tagToContentPropMap={option:"textContent",textarea:"value"},clean=function(e){return e.split("\\").join("\\\\").split("\n").join("\\n").split('"').join('\\"').split("	").join("\\t")},reverseTagMap={tr:"tbody",option:"select",td:"tr",th:"tr",li:"ul"},getTag=function(e,t,n){if(e)return e;while(n<t.length){if(t[n]=="<"&&reverseTagMap[t[n+1]])return reverseTagMap[t[n+1]];n++}},bracketNum=function(e){return--e.split("{").length- --e.split("}").length},myEval=function(script){eval(script)},attrReg=/([^\s]+)[\s]*=[\s]*$/,startTxt="var ___v1ew = [];",finishTxt="return ___v1ew.join('')",put_cmd="___v1ew.push(",insert_cmd=put_cmd,htmlTag=null,quote=null,beforeQuote=null,rescan=null,status=function(){return quote?"'"+beforeQuote.match(attrReg)[1]+"'":htmlTag?1:0};return can.view.Scanner=Scanner=function(e){can.extend(this,{text:{},tokens:[]},e),this.tokenReg=[],this.tokenSimple={"<":"<",">":">",'"':'"',"'":"'"},this.tokenComplex=[],this.tokenMap={};for(var t=0,n;n=this.tokens[t];t++)n[2]?(this.tokenReg.push(n[2]),this.tokenComplex.push({abbr:n[1],re:new RegExp(n[2]),rescan:n[3]})):(this.tokenReg.push(n[1]),this.tokenSimple[n[1]]=n[0]),this.tokenMap[n[0]]=n[1];this.tokenReg=new RegExp("("+this.tokenReg.slice(0).concat(["<",">",'"',"'"]).join("|")+")","g")},Scanner.prototype={helpers:[{name:/\s*\(([\$\w]+)\)\s*->([^\n]*)/,fn:function(e){var t=/\s*\(([\$\w]+)\)\s*->([^\n]*)/,n=e.match(t);return"function(__){var "+n[1]+"=can.$(__);"+n[2]+"}"}}],scan:function(e,t){var n=[],r=0,i=this.tokenSimple,s=this.tokenComplex;e=e.replace(newLine,"\n"),e.replace(this.tokenReg,function(t,o){var u=arguments[arguments.length-2];u>r&&n.push(e.substring(r,u));if(i[t])n.push(t);else for(var a=0,f;f=s[a];a++)if(f.re.test(t)){n.push(f.abbr),f.rescan&&n.push(f.rescan(o));break}r=u+o.length}),r<e.length&&n.push(e.substr(r));var o="",u=[startTxt+(this.text.start||"")],a=function(e,t){u.push(put_cmd,'"',clean(e),'"'+(t||"")+");")},f=[],l,c=null,h=!1,p="",d=[],v,m=0,g,y=this.tokenMap;htmlTag=quote=beforeQuote=null;for(;(g=n[m++])!==undefined;){if(c===null)switch(g){case y.left:case y.escapeLeft:case y.returnLeft:h=htmlTag&&1;case y.commentLeft:c=g,o.length&&a(o),o="";break;case y.escapeFull:h=htmlTag&&1,rescan=1,c=y.escapeLeft,o.length&&a(o),rescan=n[m++],o=rescan.content||rescan,rescan.before&&a(rescan.before),n.splice(m,0,y.right);break;case y.commentFull:break;case y.templateLeft:o+=y.left;break;case"<":n[m].indexOf("!--")!==0&&(htmlTag=1,h=0),o+=g;break;case">":htmlTag=0;var b=o.substr(o.length-1)=="/";h||tagToContentPropMap[d[d.length-1]]?(b?a(o.substr(0,o.length-1),',can.view.pending(),"/>"'):a(o,',can.view.pending(),">"'),o=""):o+=g,b&&(d.pop(),p=d[d.length-1]);break;case"'":case'"':htmlTag&&(quote&&quote===g?quote=null:quote===null&&(quote=g,beforeQuote=l));default:l==="<"&&(p=g.split(/\s/)[0],p.indexOf("/")===0&&d.pop()===p.substr(1)?p=d[d.length-1]:d.push(p)),o+=g}else switch(g){case y.right:case y.returnRight:switch(c){case y.left:v=bracketNum(o),v==1?(u.push(insert_cmd,"can.view.txt(0,'"+getTag(p,n,m)+"',"+status()+",this,function(){",startTxt,o),f.push({before:"",after:finishTxt+"}));\n"})):(r=f.length&&v==-1?f.pop():{after:";"},r.before&&u.push(r.before),u.push(o,";",r.after));break;case y.escapeLeft:case y.returnLeft:v=bracketNum(o),v&&f.push({before:finishTxt,after:"}));"});var w=c===y.escapeLeft?1:0,E={insert:insert_cmd,tagName:getTag(p,n,m),status:status()};for(var S=0;S<this.helpers.length;S++){var x=this.helpers[S];if(x.name.test(o)){o=x.fn(o,E),x.name.source==/^>[\s]*\w*/.source&&(w=0);break}}typeof o=="object"?o.raw&&u.push(o.raw):u.push(insert_cmd,"can.view.txt("+w+",'"+p+"',"+status()+",this,function(){ "+(this.text.escape||"")+"return ",o,v?startTxt:"}));"),rescan&&rescan.after&&rescan.after.length&&(a(rescan.after.length),rescan=null)}c=null,o="";break;case y.templateLeft:o+=y.left;break;default:o+=g}l=g}o.length&&a(o),u.push(";");var T=u.join(""),N={out:"with(_VIEW) { with (_CONTEXT) {"+T+" "+finishTxt+"}}"};return myEval.call(N,"this.fn = (function(_CONTEXT,_VIEW){"+N.out+"});\r\n//@ sourceURL="+t+".js"),N}},Scanner}),define("can/view/render",["can/view","can/util/string"],function(e){var t=!0;try{document.createTextNode("")._=0}catch(n){t=!1}var r={"class":"className",value:"value",textContent:"textContent"},i={"":"span",table:"tr",tr:"td",ol:"li",ul:"li",tbody:"tr",thead:"tr",tfoot:"tr",select:"option",optgroup:"option"},s="__!!__",o=/__!!__/g,u={option:"textContent",textarea:"value"},a=e.each(["checked","disabled","readonly","required"],function(e){r[e]=e}),f=function(e,t){return t&&e.parentNode.nodeType===11?t:e.parentNode},l=function(t,n,i){var s=t.nodeName.toString().toLowerCase(),o=r[n];o?(t[o]=e.inArray(n,a)>-1?!0:i,o==="value"&&s==="input"&&(t.defaultValue=i)):t.setAttribute(n,i)},c=function(e,t){return(r[t]?e[r[t]]:e.getAttribute(t))||""},h=function(t,n){e.inArray(n,a)>-1?t[n]=!1:t.removeAttribute(n)},p=[],d=function(e){if(typeof e=="string")return e;if(!e&&e!==0)return"";var t=e.hookup&&function(t,n){e.hookup.call(e,t,n)}||typeof e=="function"&&e;return t?(p.push(t),""):""+e},v=function(t){return typeof t=="string"||typeof t=="number"?e.esc(t):d(t)},m={},g={},y={},b="ejs_"+Math.random(),w=0,E=function(e){if(t||e.nodeType!==3)return e[b]?e[b]:e[b]=(e.nodeName?"element_":"obj_")+ ++w;for(var n in g)if(g[n]===e)return n;return g["text_"+ ++w]=e,"text_"+w},S=function(t,n){var r=m[E(t)];if(r){var i=e.inArray(n,r);i>=0&&r.splice(i,1),r.length||delete m[E(t)]}},x=function(e,t){var n=m[E(e)];n||(n=m[E(e)]=[]),n.push(t)},T=function(e){var t=i[e]||"span";return t==="span"?"@@!!@@":"<"+t+">"+T(t)+"</"+t+">"};return e.extend(e.view,{pending:function(){var t=p.slice(0);return lastHookups=t,p=[],e.view.hook(function(n){e.each(t,function(e){e(n)})})},registerNode:function(t){var n=E(t);y[n]=t,e.each(t,function(e){x(e,n)})},unregisterNode:function(t){var n=E(t);e.each(t,function(e){S(e,n)}),delete y[n]},txt:function(t,n,r,a,m){var g=e.compute.binder(m,a,function(e,t){N(e,t)});if(!g.isListening)return(t||r!==0?v:d)(g.value);var y,b,w=function(){g.teardown(),b&&e.view.unregisterNode(b)},E=function(t){e.bind.call(t,"destroyed",w),y=t},S=function(t){t||(w(),e.unbind.call(y,"destroyed",w))},x=i[n]||"span",N,C=u[n];if(r===0&&!C)return"<"+x+e.view.hook(t?function(e,t){N=function(e){r.nodeValue=""+e,S(r.parentNode)};var n=f(e,t),r=document.createTextNode(g.value);n.insertBefore(r,e),n.removeChild(e),E(n)}:function(t,n){N=function(e){var t=r[0].parentNode;t&&i(e),S(r[0].parentNode)},n=f(t,n);var r,i=function(i){var s=e.view.frag(i,n),o=e.makeArray(s.childNodes),u=r?r[r.length-1]:t;u.nextSibling?u.parentNode.insertBefore(s,u.nextSibling):u.parentNode.appendChild(s),r?(e.remove(e.$(r)),e.view.replace(r,o)):(e.remove(e.$(t)),r=o,b=r,e.view.registerNode(r))};i(g.value,[t]),E(n)})+">"+T(x)+"</"+x+">";if(r===1){var k=g.value.replace(/['"]/g,"").split("=")[0];return p.push(function(e){N=function(t){var n=(t||"").replace(/['"]/g,"").split("="),r=n[0];r!=k&&k&&h(e,k),r&&(l(e,r,n[1]),k=r)},E(e)}),g.value}var L=r===0?C:r;return(r===0?lastHookups:p).push(function(t){N=function(){l(t,L,f.render(),C)};var n=e.$(t),r;r=e.data(n,"hooks"),r||e.data(n,"hooks",r={});var i=c(t,L,C),u=i.split(s),a=[],f;a.push(u.shift(),u.join(s)),r[L]?r[L].bindings.push(g):r[L]={render:function(){var e=0,t=i.replace(o,function(){return d(f.bindings[e++].value)});return t},bindings:[g],batchNum:undefined},f=r[L],a.splice(1,0,g.value),l(t,L,a.join(""),C),E(t)}),s},replace:function(t,n){t=e.makeArray(t),e.each(t,function(r){e.each(e.makeArray(m[E(r)]),function(i){var s=y[i],o=e.inArray(r,s),u=e.inArray(t[t.length-1],s);if(o>=0&&u>=0){for(var a=o;a<=u;a++){var f=s[a];S(f,i)}s.splice.apply(s,[o,u-o+1].concat(n)),e.each(n,function(e){x(e,i)})}else e.view.unregisterNode(s)})})},canExpando:t,textNodeMap:g,nodeMap:m,nodeListMap:y}),e}),define("can/view/ejs",["can/util/library","can/view","can/util/string","can/observe/compute","can/view/scanner","can/view/render"],function(e){var t=e.extend,n=function(e){if(this.constructor!=n){var r=new n(e);return function(e,t){return r.render(e,t)}}if(typeof e=="function"){this.template={fn:e};return}t(this,e),this.template=this.scanner.scan(this.text,this.name)};return e.EJS=n,n.prototype.render=function(e,t){return e=e||{},this.template.fn.call(e,e,new n.Helpers(e,t||{}))},t(n.prototype,{scanner:new e.view.Scanner({tokens:[["templateLeft","<%%"],["templateRight","%>"],["returnLeft","<%=="],["escapeLeft","<%="],["commentLeft","<%#"],["left","<%"],["right","%>"],["returnRight","%>"]]})}),n.Helpers=function(e,n){this._data=e,this._extras=n,t(this,n)},n.Helpers.prototype={list:function(t,n){e.each(t,function(e,r){n(e,r,t)})}},e.view.register({suffix:"ejs",script:function(e,t){return"can.EJS(function(_CONTEXT,_VIEW) { "+(new n({text:t,name:e})).template.out+" })"},renderer:function(e,t){return n({text:t,name:e})}}),e}),define("can/construct",["can/util/string"],function(e){var t=0;return e.Construct=function(){if(arguments.length)return e.Construct.extend.apply(e.Construct,arguments)},e.extend(e.Construct,{newInstance:function(){var e=this.instance(),t=arguments,n;return e.setup&&(n=e.setup.apply(e,arguments)),e.init&&e.init.apply(e,n||arguments),e},_inherit:function(t,n,r){e.extend(r||t,t||{})},_overwrite:function(e,t,n,r){e[n]=r},setup:function(t,n){this.defaults=e.extend(!0,{},t.defaults,this.defaults)},instance:function(){t=1;var e=new this;return t=0,e},extend:function(n,r,i){function c(){if(!t)return this.constructor!==c&&arguments.length?arguments.callee.extend.apply(arguments.callee,arguments):this.constructor.newInstance.apply(this.constructor,arguments)}typeof n!="string"&&(i=r,r=n,n=null),i||(i=r,r=null),i=i||{};var s=this,o=this.prototype,u,a,f,l;l=this.instance(),e.Construct._inherit(i,o,l);for(u in s)s.hasOwnProperty(u)&&(c[u]=s[u]);e.Construct._inherit(r,s,c);if(n){var h=n.split("."),a=h.pop(),p=e.getObject(h.join("."),window,!0),f=p,d=e.underscore(n.replace(/\./g,"_")),v=e.underscore(a);p[a]=c}e.extend(c,{constructor:c,prototype:l,namespace:f,shortName:a,_shortName:v,fullName:n,_fullName:d}),c.prototype.constructor=c;var m=[s].concat(e.makeArray(arguments)),g=c.setup.apply(c,m);return c.init&&c.init.apply(c,g||m),c}}),e.Construct}),define("can/control",["can/util/library","can/construct"],function(e){var t=function(t,n,r){return e.bind.call(t,n,r),function(){e.unbind.call(t,n,r)}},n=e.isFunction,r=e.extend,i=e.each,s=[].slice,o=/\{([^\}]+)\}/g,u=e.getObject("$.event.special",[e])||{},a=function(t,n,r,i){return e.delegate.call(t,n,r,i),function(){e.undelegate.call(t,n,r,i)}},f=function(n,r,i,s){return s?a(n,e.trim(s),r,i):t(n,r,i)},l,c=e.Control=e.Construct({setup:function(){e.Construct.setup.apply(this,arguments);if(e.Control){var t=this,n;t.actions={};for(n in t.prototype)t._isAction(n)&&(t.actions[n]=t._action(n))}},_shifter:function(t,r){var i=typeof r=="string"?t[r]:r;return n(i)||(i=t[i]),function(){return t.called=r,i.apply(t,[this.nodeName?e.$(this):this].concat(s.call(arguments,0)))}},_isAction:function(e){var t=this.prototype[e],r=typeof t;return e!=="constructor"&&(r=="function"||r=="string"&&n(this.prototype[t]))&&!!(u[e]||h[e]||/[^\w]/.test(e))},_action:function(t,n){o.lastIndex=0;if(n||!o.test(t)){var r=n?e.sub(t,[n,window]):t;if(!r)return null;var i=e.isArray(r),s=i?r[1]:r,u=s.split(/\s+/g),a=u.pop();return{processor:h[a]||l,parts:[s,u.join(" "),a],delegate:i?r[0]:undefined}}},processors:{},defaults:{}},{setup:function(t,n){var i=this.constructor,s=i.pluginName||i._fullName,o;return this.element=e.$(t),s&&s!=="can_control"&&this.element.addClass(s),(o=e.data(this.element,"controls"))||e.data(this.element,"controls",o=[]),o.push(this),this.options=r({},i.defaults,n),this.on(),[this.element,this.options]},on:function(t,n,r,i){if(!t){this.off();var s=this.constructor,o=this._bindings,u=s.actions,a=this.element,l=e.Control._shifter(this,"destroy"),c,h;for(c in u)u.hasOwnProperty(c)&&(h=u[c]||s._action(c,this.options))&&o.push(h.processor(h.delegate||a,h.parts[2],h.parts[1],c,this));return e.bind.call(a,"destroyed",l),o.push(function(t){e.unbind.call(t,"destroyed",l)}),o.length}return typeof t=="string"&&(i=r,r=n,n=t,t=this.element),i===undefined&&(i=r,r=n,n=null),typeof i=="string"&&(i=e.Control._shifter(this,i)),this._bindings.push(f(t,r,i,n)),this._bindings.length},off:function(){var e=this.element[0];i(this._bindings||[],function(t){t(e)}),this._bindings=[]},destroy:function(){var t=this.constructor,n=t.pluginName||t._fullName,r;this.off(),n&&n!=="can_control"&&this.element.removeClass(n),r=e.data(this.element,"controls"),r.splice(e.inArray(this,r),1),e.trigger(this,"destroyed"),this.element=null}}),h=e.Control.processors,l=function(t,n,r,i,s){return f(t,n,e.Control._shifter(s,i),r)};return i(["change","click","contextmenu","dblclick","keydown","keyup","keypress","mousedown","mousemove","mouseout","mouseover","mouseup","reset","resize","scroll","select","submit","focusin","focusout","mouseenter","mouseleave","touchstart","touchmove","touchcancel","touchend","touchleave"],function(e){h[e]=l}),c}),define("can/observe",["can/util/library","can/construct"],function(e){var t=function(t){return t&&(e.isArray(t)||e.isPlainObject(t)||t instanceof e.Observe)},n=function(t,n){return e.each(t,function(e){e&&e.unbind&&e.unbind("change"+n)})},r=function(t,r,i,s,o){return s=s||v,o=o||v.List,t instanceof v?n([t],i._cid):e.isArray(t)?t=new o(t):t=new s(t),t.bind("change"+i._cid,function(){var n=e.makeArray(arguments),s=n.shift();n[0]=(r==="*"?[i.indexOf(t),n[0]]:[r,n[0]]).join("."),s.triggeredNS=s.triggeredNS||{};if(s.triggeredNS[i._cid])return;s.triggeredNS[i._cid]=!0,e.trigger(i,s,n)}),t},i=0,s=function(n,r,i){return n.each(function(n,s){i[s]=t(n)&&e.isFunction(n[r])?n[r]():n}),i},o=function(t){return function(){return e[t].apply(this,arguments)}},u=o("addEvent"),a=o("removeEvent"),f=function(t){return e.isArray(t)?t:(""+t).split(".")},l=1,c=0,h=[],p=[],d=0;e.cid=function(e,t){return e._cid?e._cid:e._cid=(t||"")+ ++d};var v=e.Observe=e.Construct({bind:u,unbind:a,id:"id",canMakeObserve:t,startBatch:function(e){c++,e&&p.push(e)},stopBatch:function(t,n){t?c=0:c--;if(c==0){var r=h.slice(0),i=p.slice(0);h=[],p=[],l++,n&&this.startBatch(),e.each(r,function(t){e.trigger.apply(e,t)}),e.each(i,function(e){e})}},triggerBatch:function(t,n,r){if(!t._init){if(c==0)return e.trigger(t,n,r);h.push([t,{type:n,batchNum:l},r])}},keys:function(e){var t=[];v.__reading&&v.__reading(e,"__keys");for(var n in e._data)t.push(n);return t}},{setup:function(t){this._data={},e.cid(this,".observe"),this._init=1,this.attr(t),this.bind("change"+this._cid,e.proxy(this._changes,this)),delete this._init},_changes:function(e,t,n,r,i){v.triggerBatch(this,{type:t,batchNum:e.batchNum},[r,i])},_triggerChange:function(t,n,r,i){v.triggerBatch(this,"change",e.makeArray(arguments))},attr:function(e,t){var n=typeof e;return n!=="string"&&n!=="number"?this._attrs(e,t):t===undefined?(v.__reading&&v.__reading(this,e),this._get(e)):(this._set(e,t),this)},each:function(){return v.__reading&&v.__reading(this,"__keys"),e.each.apply(undefined,[this.__get()].concat(e.makeArray(arguments)))},removeAttr:function(e){var t=f(e),n=t.shift(),r=this._data[n];return t.length?r.removeAttr(t):(n in this._data&&(delete this._data[n],n in this.constructor.prototype||delete this[n],v.triggerBatch(this,"__keys"),this._triggerChange(n,"remove",undefined,r)),r)},_get:function(e){var t=f(e),n=this.__get(t.shift());return t.length?n?n._get(t):undefined:n},__get:function(e){return e?this._data[e]:this._data},_set:function(e,n){var r=f(e),i=r.shift(),s=this.__get(i);if(t(s)&&r.length)s._set(r,n);else{if(!!r.length)throw"can.Observe: Object does not exist";this.__convert&&(n=this.__convert(i,n)),this.__set(i,n,s)}},__set:function(e,i,s){if(i!==s){var o=this.__get().hasOwnProperty(e)?"set":"add";this.___set(e,t(i)?r(i,e,this):i),o=="add"&&v.triggerBatch(this,"__keys",undefined),this._triggerChange(e,o,i,s),s&&n([s],this._cid)}},___set:function(e,t){this._data[e]=t,e in this.constructor.prototype||(this[e]=t)},bind:u,unbind:a,serialize:function(){return s(this,"serialize",{})},_attrs:function(r,i){if(r===undefined)return s(this,"attr",{});r=e.extend({},r);var o,u=this,a;v.startBatch(),this.each(function(s,o,f){a=r[o];if(a===undefined){i&&u.removeAttr(o);return}u.__convert&&(a=u.__convert(o,a)),s!==a&&(s instanceof e.Observe&&a instanceof e.Observe&&n([s],u._cid),a instanceof e.Observe?u._set(o,a):t(s)&&t(a)?s.attr(a,f):s!=a&&u._set(o,a)),delete r[o]});for(var o in r)a=r[o],this._set(o,a);return v.stopBatch(),this},compute:function(t){var n=this,r=function(e){return n.attr(t,e)};return e.compute?e.compute(r):r}}),m=[].splice,g=v({setup:function(t,n){this.length=0,e.cid(this,".observe"),this._init=1,this.push.apply(this,t||[]),this.bind("change"+this._cid,e.proxy(this._changes,this)),e.extend(this,n),delete this._init},_triggerChange:function(e,t,n,r){v.prototype._triggerChange.apply(this,arguments),~e.indexOf(".")||(t==="add"?(v.triggerBatch(this,t,[n,+e]),v.triggerBatch(this,"length",[this.length])):t==="remove"?(v.triggerBatch(this,t,[r,+e]),v.triggerBatch(this,"length",[this.length])):v.triggerBatch(this,t,[n,+e]))},__get:function(e){return e?this[e]:this},___set:function(e,t){this[e]=t,+e>=this.length&&(this.length=+e+1)},serialize:function(){return s(this,"serialize",[])},splice:function(i,s){var o=e.makeArray(arguments),u;for(u=2;u<o.length;u++){var a=o[u];t(a)&&(o[u]=r(a,"*",this))}s===undefined&&(s=o[1]=this.length-i);var f=m.apply(this,o);return e.Observe.startBatch(),s>0&&(this._triggerChange(""+i,"remove",undefined,f),n(f,this._cid)),o.length>2&&this._triggerChange(""+i,"add",o.slice(2),f),e.Observe.stopBatch(),f},_attrs:function(t,n){if(t===undefined)return s(this,"attr",[]);t=e.makeArray(t),v.startBatch(),this._updateAttrs(t,n),v.stopBatch()},_updateAttrs:function(e,n){var r=Math.min(e.length,this.length);for(var i=0;i<r;i++){var s=this[i],o=e[i];t(s)&&t(o)?s.attr(o,n):s!=o&&this._set(i,o)}e.length>this.length?this.push.apply(this,e.slice(this.length)):e.length<this.length&&n&&this.splice(e.length)}}),y=function(t){return t[0]&&e.isArray(t[0])?t[0]:e.makeArray(t)};return e.each({push:"length",unshift:0},function(e,n){var i=[][n];g.prototype[n]=function(){var n=[],s=e?this.length:0,o=arguments.length,u,a,f=this.constructor;while(o--)a=arguments[o],n[o]=t(a)?r(a,"*",this,this.constructor.Observe,this.constructor):a;return u=i.apply(this,n),(!this.comparator||!n.length)&&this._triggerChange(""+s,"add",n,undefined),u}}),e.each({pop:"length",shift:0},function(e,t){g.prototype[t]=function(){var n=y(arguments),r=e&&this.length?this.length-1:0,i=[][t].apply(this,n);return this._triggerChange(""+r,"remove",undefined,[i]),i&&i.unbind&&i.unbind("change"+this._cid),i}}),e.extend(g.prototype,{indexOf:function(t){return this.attr("length"),e.inArray(t,this)},join:[].join,slice:function(){var e=Array.prototype.slice.apply(this,arguments);return new this.constructor(e)},concat:function(){var t=[];return e.each(e.makeArray(arguments),function(n,r){t[r]=n instanceof e.Observe.List?n.serialize():n}),new this.constructor(Array.prototype.concat.apply(this.serialize(),t))},forEach:function(t,n){e.each(this,t,n||this)},replace:function(t){return e.isDeferred(t)?t.then(e.proxy(this.replace,this)):this.splice.apply(this,[0,this.length].concat(e.makeArray(t||[]))),this}}),v.List=g,v.setup=function(){e.Construct.setup.apply(this,arguments),this.List=v.List({Observe:this},{})},v}),define("can/model",["can/util/library","can/observe"],function(e){var t=function(t,n,r){var i=new e.Deferred;return t.then(function(){var t=e.makeArray(arguments);t[0]=n[r](t[0]),i.resolveWith(i,t)},function(){i.rejectWith(this,arguments)}),typeof t.abort=="function"&&(i.abort=function(){return t.abort()}),i},n=0,r=/change.observe\d+/,i=function(t){return e.Observe.__reading&&e.Observe.__reading(t,t.constructor.id),t.__get(t.constructor.id)},s=function(t,n,r,i,s,o){var u={};if(typeof t=="string"){var a=t.split(/\s/);u.url=a.pop(),a.length&&(u.type=a.pop())}else e.extend(u,t);return u.data=typeof n=="object"&&!e.isArray(n)?e.extend(u.data||{},n):n,u.url=e.sub(u.url,u.data,!0),e.ajax(e.extend({type:r||"post",dataType:i||"json",success:s,error:o},u))},o=function(e,t,n,r,s){var o,u=[e.serialize()],a=e.constructor,f;return t=="destroy"&&u.shift(),t!=="create"&&u.unshift(i(e)),f=a[t].apply(a,u),o=f.pipe(function(n){return e[s||t+"d"](n,f),e}),f.abort&&(o.abort=function(){f.abort()}),o.then(n,r),o},u={create:{url:"_shortName",type:"post"},update:{data:function(t,n){n=n||{};var r=this.id;return n[r]&&n[r]!==t&&(n["new"+e.capitalize(t)]=n[r],delete n[r]),n[r]=t,n},type:"put"},destroy:{type:"delete",data:function(e){var t={};return t.id=t[this.id]=e,t}},findAll:{url:"_shortName"},findOne:{}},a=function(e,t){return function(n){return n=e.data?e.data.apply(this,arguments):n,s(t||this[e.url||"_url"],n,e.type||"get")}};e.Model=e.Observe({fullName:"can.Model",setup:function(t){this.store={},e.Observe.setup.apply(this,arguments);if(!e.Model)return;this.List=f({Observe:this},{});var r=this,i=e.proxy(this._clean,r);e.each(u,function(n,s){e.isFunction(r[s])||(r[s]=a(n,r[s]));if(r["make"+e.capitalize(s)]){var o=r["make"+e.capitalize(s)](r[s]);e.Construct._overwrite(r,t,s,function(){this._reqs++;var e=o.apply(this,arguments),t=e.then(i,i);return t.abort=e.abort,t})}});if(r.fullName=="can.Model"||!r.fullName)r.fullName="Model"+ ++n;this._reqs=0,this._url=this._shortName+"/{"+this.id+"}"},_ajax:a,_clean:function(){this._reqs--;if(!this._reqs)for(var e in this.store)this.store[e]._bindings||delete this.store[e];return arguments[0]},models:function(t,n){if(!t)return;if(t instanceof this.List)return t;var r=this,i=[],s=n instanceof e.Observe.List?n:new(r.List||f),o=e.isArray(t),u=t instanceof f,a=o?t:u?t.serialize():t.data,l=0;return s.length>0&&s.splice(0),e.each(a,function(e){i.push(r.model(e))}),s.push.apply(s,i),o||e.each(t,function(e,t){t!=="data"&&s.attr(t,e)}),s},model:function(e){if(!e)return;e instanceof this&&(e=e.serialize());var t=e[this.id],n=t&&this.store[t]?this.store[t].attr(e):new this(e);return this._reqs&&(this.store[e[this.id]]=n),n}},{isNew:function(){var e=i(this);return!e&&e!==0},save:function(e,t){return o(this,this.isNew()?"create":"update",e,t)},destroy:function(e,t){return o(this,"destroy",e,t,"destroyed")},bind:function(t){return r.test(t)||(this._bindings||(this.constructor.store[this.__get(this.constructor.id)]=this,this._bindings=0),this._bindings++),e.Observe.prototype.bind.apply(this,arguments)},unbind:function(t){return r.test(t)||(this._bindings--,this._bindings||delete this.constructor.store[i(this)]),e.Observe.prototype.unbind.apply(this,arguments)},___set:function(t,n){e.Observe.prototype.___set.call(this,t,n),t===this.constructor.id&&this._bindings&&(this.constructor.store[i(this)]=this)}}),e.each({makeFindAll:"models",makeFindOne:"model"},function(n,r){e.Model[r]=function(e){return function(r,i,s){var o=t(e.call(this,r),this,n);return o.then(i,s),o}}}),e.each(["created","updated","destroyed"],function(t){e.Model.prototype[t]=function(n){var r,i=this.constructor;r=n&&typeof n=="object"&&this.attr(n.attr?n.attr():n),e.trigger(this,t),e.trigger(this,"change",t),e.trigger(i,t,this)}});var f=e.Model.List=e.Observe.List({setup:function(){e.Observe.List.prototype.setup.apply(this,arguments);var t=this;this.bind("change",function(e,n){if(/\w+\.destroyed/.test(n)){var r=t.indexOf(e.target);r!=-1&&t.splice(r,1)}})}});return e.Model}),define("can/util/string/deparam",["can/util/library","can/util/string"],function(e){var t=/^\d+$/,n=/([^\[\]]+)|(\[\])/g,r=/([^?#]*)(#.*)?$/,i=function(e){return decodeURIComponent(e.replace(/\+/g," "))};return e.extend(e,{deparam:function(s){var o={},u,a;return s&&r.test(s)&&(u=s.split("&"),e.each(u,function(e){var r=e.split("="),s=i(r.shift()),u=i(r.join("=")),f=o;r=s.match(n);for(var l=0,c=r.length-1;l<c;l++)f[r[l]]||(f[r[l]]=t.test(r[l+1])||r[l+1]=="[]"?[]:{}),f=f[r[l]];a=r.pop(),a=="[]"?f.push(u):f[a]=u})),o}}),e}),define("can/route",["can/util/library","can/observe","can/util/string/deparam"],function(e){var t=/\:([\w\.]+)/g,n=/^(?:&[^=]+=[^&]*)+/,r=function(t){var n=[];return e.each(t,function(t,r){n.push((r==="className"?"class":r)+'="'+(r==="href"?t:e.esc(t))+'"')}),n.join(" ")},i=function(e,t){var n=0,r=0,i={};for(var s in e.defaults)e.defaults[s]===t[s]&&(i[s]=1,n++);for(;r<e.names.length;r++){if(!t.hasOwnProperty(e.names[r]))return-1;i[e.names[r]]||n++}return n},s=!0,o=window.location,u=function(e){return(e+"").replace(/([.?*+\^$\[\]\\(){}|\-])/g,"\\$1")},a=e.each,f=e.extend;e.route=function(n,r){r=r||{};var i=[],s=n.replace(t,function(t,s,o){i.push(s);var u="\\"+(n.substr(o+t.length,1)||e.route._querySeparator);return"([^"+u+"]"+(r[s]?"*":"+")+")"});return e.route.routes[n]={test:new RegExp("^"+s+"($|"+u(e.route._querySeparator)+")"),route:n,names:i,defaults:r,length:n.split("/").length},e.route},f(e.route,{_querySeparator:"&",_paramsMatcher:n,param:function(n,r){var s,o=0,u,l=n.route,c=0;delete n.route,a(n,function(){c++}),a(e.route.routes,function(e,t){u=i(e,n),u>o&&(s=e,o=u);if(u>=c)return!1}),e.route.routes[l]&&i(e.route.routes[l],n)===o&&(s=e.route.routes[l]);if(s){var h=f({},n),p=s.route.replace(t,function(e,t){return delete h[t],n[t]===s.defaults[t]?"":encodeURIComponent(n[t])}),d;return a(s.defaults,function(e,t){h[t]===e&&delete h[t]}),d=e.param(h),r&&e.route.attr("route",s.route),p+(d?e.route._querySeparator+d:"")}return e.isEmptyObject(n)?"":e.route._querySeparator+e.param(n)},deparam:function(t){var n={length:-1};a(e.route.routes,function(e,r){e.test.test(t)&&e.length>n.length&&(n=e)});if(n.length>-1){var r=t.match(n.test),i=r.shift(),s=t.substr(i.length-(r[r.length-1]===e.route._querySeparator?1:0)),o=s&&e.route._paramsMatcher.test(s)?e.deparam(s.slice(1)):{};return o=f(!0,{},n.defaults,o),a(r,function(t,r){t&&t!==e.route._querySeparator&&(o[n.names[r]]=decodeURIComponent(t))}),o.route=n.route,o}return t.charAt(0)!==e.route._querySeparator&&(t=e.route._querySeparator+t),e.route._paramsMatcher.test(t)?e.deparam(t.slice(1)):{}},data:new e.Observe({}),routes:{},ready:function(t){t===!1&&(s=t);if(t===!0||s===!0)e.route._setup(),h();return e.route},url:function(t,n){return n&&(t=f({},c,t)),"#!"+e.route.param(t)},link:function(t,n,i,s){return"<a "+r(f({href:e.route.url(n,s)},i))+">"+t+"</a>"},current:function(t){return o.hash=="#!"+e.route.param(t)},_setup:function(){e.bind.call(window,"hashchange",h)},_getHash:function(){return o.href.split(/#!?/)[1]||""},_setHash:function(t){var n=e.route.param(t,!0);return o.hash="#!"+n,n}}),a(["bind","unbind","delegate","undelegate","attr","removeAttr"],function(t){e.route[t]=function(){return e.route.data[t].apply(e.route.data,arguments)}});var l,c,h=e.route.setState=function(){var t=e.route._getHash();c=e.route.deparam(t),(!d||t!==p)&&e.route.attr(c,!0)},p,d;return e.route.bind("change",function(t,n){d=1,clearTimeout(l),l=setTimeout(function(){d=0;var t=e.route.data.serialize();p=e.route._setHash(t)},1)}),e.bind.call(document,"ready",e.route.ready),e.route.constructor.canMakeObserve=e.Observe.canMakeObserve,e.route}),define("can",["can/util/library","can/control","can/model","can/view/ejs","can/route"],function(e){return e}),define("app/model/stat",["can"],function(e){var t=[{id:1,name:"standard",bint:13400,bspi:8394,bmast:3831,bcrit:2628,bhaste:555,bweapon:5812}],n=new e.Observe(t[0]);return n}),define("text!view/stats.ejs",[],function(){return'<div <%= (el) -> can.data(el, \'stat\', stats) %> ><a class="expandOn"><h4>Stats</h4></a>\n<div>\n<label>Intellect</label><input type="input" id="bint" value="<%= stats.attr(\'bint\'); %>"/ >\n<label>Spirit</label><input type="input" id="bspi" value="<%= stats.attr(\'bspi\'); %>"/ >\n<label>Crit Rating</label><input type="input" id="bcrit" value="<%= stats.attr(\'bcrit\'); %>"/ >\n<label>Haste Rating</label><input type="input" id="bhaste" value="<%= stats.attr(\'bhaste\'); %>"/ >\n<label>Mastery Rating</label><input type="input" id="bmast" value="<%= stats.attr(\'bmast\'); %>"/ >\n<label>Weapon Sp</label><input type="input" id="bweapon" value="<%= stats.attr(\'bweapon\'); %>"/ >\n</div>\n</div>\n'}),define("app/control/stats",["can","text!view/stats.ejs"],function(e,t){e.view.ejs("statsView",t);var n=e.Control({init:function(t,n){this.element=t,this.options.stats=n.stats,console.log(this.options.stats),this.element.html(e.view("statsView",this.options)),console.log(this.options.stats===$("div",$("#stats")).data("stat"))},"input change":function(e,t){var n=e.attr("id"),r=e.val();this.options.stats.attr(n,r*1)}});return n}),define("app/model/buff",["can"],function(e){var t=new e.Observe({stats:!0,mastery:!0,haste:!0,crit:!0,sp:!0,armor:!0,spelldam:!1,intfood:!0,intflask:!0,crit_meta:!0,mana_meta:!1,focus_pot:!0});return t}),define("text!view/buffs.ejs",[],function(){return'<div <%= (el) -> can.data(el, \'buffs\', buffs[0]) %>><a class="expandOff"><h4>Buffs</h4></a>\n  <div>\n    <ul><li><a class="expandOff">Raid Buffs</a>\n    <div>\n      <label for="buff_stats">+5% all stats</label><input type="checkbox" id="buff_stats"  <%= buffs.attr(\'stats\') ? \'checked="checked"\' : \'\' %> />\n      <label for="buff_mastery">+5 mastery</label><input type="checkbox" id="buff_mastery"  <%= buffs.attr(\'mastery\') ? \'checked="checked"\' : \'\' %> />\n      <label for="buff_haste">+5% haste</label><input type="checkbox" id="buff_haste"  <%= buffs.attr(\'haste\') ? \'checked="checked"\' : \'\' %> />\n      <label for="buff_crit">+5% crit chance</label><input type="checkbox" id="buff_crit"  <%= buffs.attr(\'crit\') ? \'checked="checked"\' : \'\' %> />\n      <label for="buff_sp">+10% spellpower</label><input type="checkbox" id="buff_sp"  <%= buffs.attr(\'sp\') ? \'checked="checked"\' : \'\' %> />\n      <label for="buff_armor">-12% armor</label><input type="checkbox" id="buff_armor"  <%= buffs.attr(\'armor\') ? \'checked="checked"\' : \'\' %> />\n      <label for="buff_spelldam">+5% spell damage</label><input type="checkbox" id="buff_spelldam"  <%= buffs.attr(\'spelldam\') ? \'checked="checked"\' : \'\' %> />\n      <label for="buff_intfood">Pandaren Banquet</label><input type="checkbox" id="buff_intfood"  <%= buffs.attr(\'intfood\') ? \'checked="checked"\' : \'\' %> />\n    </div></li>\n    <li><a class="expandOff">Personal Buffs</a>\n    <div>\n      <label for="buff_intflask">Int flask</label><input type="checkbox" id="buff_intflask"  <%= buffs.attr(\'intflask\') ? \'checked="checked"\' : \'\' %> />\n      <label for="buff_crit_meta">Crit Effect Meta Gem</label><input type="checkbox" id="buff_crit_meta"  <%= buffs.attr(\'crit_meta\') ? \'checked="checked"\' : \'\' %> />\n      <label for="buff_mana_meta">Extra Mana Meta Gem</label><input type="checkbox" id="buff_mana_meta"  <%= buffs.attr(\'mana_meta\') ? \'checked="checked"\' : \'\' %> />\n      <label for="buff_focus_pot">Use Focus Pot Instead</label><input type="checkbox" id="buff_focus_pot"  <%= buffs.attr(\'focus_pot\') ? \'checked="checked"\' : \'\' %> />\n    </div></li>\n    </ul>\n  </div>\n</div>'}),define("app/control/buffs",["can","text!view/buffs.ejs"],function(e,t){e.view.ejs("buffsView",t);var n=e.Control({init:function(t,n){var r=this,i=this.options.buffs||i;r.element.html(e.view("buffsView",{buffs:i}))},"input click":function(e,t){var n=this.options.buffs,r=e.attr("id").replace("buff_","");n.attr(r,!n.attr(r))}});return n}),define("app/model/spec",["can"],function(e){var t=[{id:1,name:"Disc",icon:"spell_holy_powerwordshield",active:!0,bcrit:1.235,bpoints_info:[{name:"Renew",img:"spell_holy_renew",nticks:4,time_tick:3,hfactor:1},{name:"Renew BT",img:"spell_holy_renew",nticks:4,time_tick:3,hfactor:1.15},{name:"Glyphed Renew",img:"spell_holy_renew",nticks:3,time_tick:3,hfactor:1},{name:"Glyphed Renew BT",img:"spell_holy_renew",nticks:3,time_tick:3,hfactor:1.15},{name:"Holy Fire",img:"spell_holy_searinglight",nticks:7,time_tick:1,hfactor:1},{name:"Holy Fire BT",img:"spell_holy_searinglight",nticks:7,time_tick:1,hfactor:1.15}],mana_sources:[{name:"Passive Regen",fmana:function(e,t){return(1*this.spi+(t&&t.spi||0)*.5*1.129+6e3)/5*(e||1)}},{name:"Initial Mana",fmana:function(e,t){return this.mana_pool*e/this.interval_time}},{name:"Potion",fmana:function(e,t){return this.potmana*e/this.interval_time}},{name:"Rapture",fmana:function(e,t){return this.spi*2*e/this.rapture_interval}},{name:"Mindbender",fmana:function(e,t){return this.mana_pool*.015*11*e/60}},{name:"Hymn of Hope",fmana:function(e,t){return this.mana_pool*(1+3*1.15)*.02*e/360}}]},{id:2,name:"Holy",icon:"spell_holy_guardianspirit",active:!1,bcrit:1.235,bpoints_info:[{name:"Renew",img:"spell_holy_renew",nticks:4,time_tick:3},{name:"Glyphed Renew",img:"spell_holy_renew",nticks:3,time_tick:3},{name:"HW:Sanc",img:"spell_holy_divineprovidence",nticks:15,time_tick:2},{name:"LW/LS",img:"spell_holy_summonlightwell",nticks:3,time_tick:2}],mana_sources:[{name:"Spirit Based",fmana:function(e,t){return(1*this.spi+(t&&t.spi||0)*.5*1.129+6e3)/5*(e||1)}},{name:"Initial Mana",fmana:function(e,t){return this.mana_pool*e/this.interval_time}},{name:"Potion",fmana:function(e,t){return this.potmana*e/this.interval_time}},{name:"Mindbender",fmana:function(e,t){return this.mana_pool*.015*11*e/60}},{name:"Hymn of Hope",fmana:function(e,t){return this.mana_pool*(1+3*1.15)*.02*e/360}}]},{id:3,name:"Pally",icon:"spell_holy_holybolt",active:!1,bcrit:3.335,bpoints_info:[{name:"EF",img:"inv_torch_thrown",nticks:10,time_tick:3},{name:"SS",img:"ability_paladin_blessedmending",nticks:5,time_tick:6}],mana_sources:[{name:"Spirit Based",fmana:function(e,t){return(1*this.spi+(t&&t.spi||0)*.5*1.129+6e3)/5*(e||1)}},{name:"Initial Mana",fmana:function(e,t){return this.mana_pool*e/this.interval_time}},{name:"Potion",fmana:function(e,t){return this.potmana*e/this.interval_time}},{name:"Divine Plea",fmana:function(e,t){return this.mana_pool*.12*e/120}}]},{id:4,name:"Druid",icon:"spell_nature_healingtouch",active:!1,bcrit:1.85,bpoints_info:[{name:"LB",img:"inv_misc_herb_felblossom",nticks:15,time_tick:1},{name:"Glyphed LB",img:"inv_misc_herb_felblossom",nticks:10,time_tick:1},{name:"WG/SM",img:"ability_druid_flourish",nticks:7,time_tick:1},{name:"Rejuv",img:"spell_nature_rejuvenation",nticks:4,time_tick:3},{name:"Tranq",img:"spell_nature_rejuvenation",nticks:4,time_tick:2},{name:"Regrowth",img:"spell_nature_resistnature",nticks:3,time_tick:2}],mana_sources:[{name:"Spirit Based",fmana:function(e,t){return((1*this.spi+(t&&t.spi||0))*.5*1.129+6e3)/5*(e||1)}},{name:"Initial Mana",fmana:function(e,t){return this.mana_pool*e/this.interval_time}},{name:"Potion",fmana:function(e,t){return this.potmana*e/this.interval_time}},{name:"Innervate",fmana:function(e,t){return this.mana_pool*.2*e/180}}]},{id:5,name:"Shaman",icon:"spell_nature_healingwavegreater",active:!1,bcrit:1.235,bpoints_info:[{name:"Riptide",img:"spell_nature_riptide",nticks:6,time_tick:3},{name:"Healing Rain",img:"spell_nature_giftofthewaterspirit",nticks:5,time_tick:2},{name:"Earthliving",img:"spell_shaman_giftearthmother",nticks:4,time_tick:4},{name:"HTT",img:"ability_shaman_healingtide",nticks:5.5,time_tick:2},{name:"HST",img:"inv_spear_04",nticks:7.5,time_tick:2}],mana_sources:[{name:"Spirit Based",fmana:function(e,t){return(1*this.spi+(t&&t.spi||0)*.5*1.129+6e3)/5*(e||1)}},{name:"Initial Mana",fmana:function(e,t){return this.mana_pool*e/this.interval_time}},{name:"Potion",fmana:function(e,t){return this.potmana*e/this.interval_time}}]},{id:6,name:"Monk",icon:"spell_monk_mistweaver_spec",active:!1,bcrit:2.19,bpoints_info:[{name:"Surging Mist, Renewing Mist",img:"ability_monk_surgingmist",nticks:6}],mana_sources:[{name:"Spirit Based",fmana:function(e,t){return(1*this.spi+(t&&t.spi||0)*.5*1.129+6e3)/5*(e||1)}},{name:"Initial Mana",fmana:function(e,t){return this.mana_pool*e/this.interval_time}},{name:"Potion",fmana:function(e,t){return this.potmana*e/this.interval_time}}]}];$.each(t,function(e,t){t.breakpoints=[];var n=.5,r,i,s,o,u=0,a;$.each(t.bpoints_info,function(e,o){r=Math.ceil(o.nticks*n+.5);for(i=1;i<r;i++)s=[i,["st","nd","rd","th","th","th"][i-1]].join(""),t.breakpoints.push({name:o.name,img:o.img,no:s,hastep:o.time_tick/((o.hfactor||1)*Math.ceil(o.time_tick*o.nticks/(o.nticks+i-.5)*1e3)/1e3-5e-4)})}),u=0,a=t.breakpoints.length;do{u++,o=0;for(i=0;i<a-1;i++){var f=t.breakpoints[i].hastep,l=t.breakpoints[i+1].hastep;if(f>l){o=1;var c=t.breakpoints[i];t.breakpoints[i]=t.breakpoints[i+1],t.breakpoints[i+1]=c}}}while(o==1&&u<200)});var n={mastery_factor:2.5,fint:function(e){return Math.round(1.05*(this.attr("buffs.stats")?1.05:1)*(this.attr("stats.bint")*1+(e&&e.int||0)+(this.attr("buffs.intfood")?275:0)+(this.attr("buffs.intflask")?1e3:0)))},fspi:function(e){return this.attr("stats.bspi")},fcrit:function(e){return Math.round(((this.attr("stats.bcrit")*1+(e&&e.crit||0))/600+this.fint(e)*3951e-7+ +this.attr("bcrit")+(this.attr("buffs.crit")?5:0))*100)/100},fcritp:function(e){return.01*this.fcrit(e)},fmast:function(e){return Math.round(((1*this.attr("stats.bmast")+(e&&e.mast||0)+(this.attr("buffs.mastery")?3e3:0))/600+8)*this.mastery_factor*100)/100},fmastp:function(e){return.01*this.fmast(e)},fhaste_mul:function(){return this.attr("buffs.haste")?1.05:1},fhaste:function(e){return((1+(this.attr("stats.bhaste")*1+(e&&e.haste||0))/425/100)*this.fhaste_mul()-1)*100},fhastep:function(e){return.01*this.fhaste(e)},fsp:function(e){return Math.round((1*this.fint(e)-10+1*this.attr("stats.bweapon")+(e&&e.sp||0))*(this.attr("buffs.sp")?1.05:1))},fmast_heal_factor:function(e){return 1+.01*this.fmast(e)},ftotal_mana:function(e){var t=0,n=this.mana_sources,r=this.mana_sources.length;while(r--)if(n[r].name==="Initial Mana"||n[r].name==="Potion")t+=n[r].fmana.call(this,this.interval_time*1,e);return t},fregen_mps:function(e){var t=0,n=this.mana_sources,r=this.mana_sources.length;while(r--)n[r].name!=="Initial Mana"&&n[r].name!=="Potion"&&(t+=n[r].fmana.call(this,1,e));return t},interval_time:60,val_update:function(){e.Observe.startBatch(),this.attr({"int":this.fint(),spi:this.fspi(),crit:this.fcrit(),critp:this.fcritp(),mast:this.fmast(),mastp:this.fmastp(),mast_heal_factor:this.fmast_heal_factor(),haste:Math.round(this.fhaste()*100)/100,hastep:this.fhastep(),sp:this.fsp(),critmeta:this.attr("buffs.crit_meta"),manameta:this.attr("buffs.mana_meta"),mana_pool:(this.attr("buffs.mana_meta")?1.02:1)*3e5,potmana:this.attr("buffs.focus_pot")?45e3:3e4});var t=this,n=0,r=0,i=0,s,o,u;t.mana_sources.each(function(a){s=e.proxy(a.fmana,t),o=Math.round(s(t.interval_time*1)),u=Math.round(10*s(1))/10,n+=o,a.name!=="Initial Mana"&&a.name!=="Potion"?r+=u:i+=o,a.attr({mana:o,mps:u})}),t.attr({regen_mana:Math.round(n),regen_mps:Math.round(10*r)/10,total_mana:Math.round(i)}),e.Observe.stopBatch()}},r=t.length,i=new e.Observe.List([]),s;for(s=0;s<r;s++)e.extend(t[s],n),i.push(t[s]);return i.find=function(e){var t=this.length;while(t--)if(this[t].name==e)return this[t];return!1},i[0].attr({mastery_factor:2.5,fsp:function(e){return Math.round((1*this.fint(e)-10+1*this.attr("stats.bweapon")+(e&&e.sp||0))*(this.attr("buffs.sp")?1.05:1)*(this.attr("inner_fire")?1.1:1))},inner_fire:!0,grace:!0,evang_stacks:5,archangel:!1,cascade_targets_disc:10,cascade_range_disc:25,poh_targets_disc:5,glyph_pom_disc:!0,glyph_renew_disc:!1,glyph_penance:!1,t4_2p_disc:!1,rapture_interval:15}),i[1].attr({mastery_factor:1.25,fsp:function(e){return Math.round((1*this.fint(e)-10+1*this.attr("stats.bweapon")+(e&&e.sp||0))*(this.attr("buffs.sp")?1.05:1)*(this.attr("inner_fire")?1.1:1))},serenity:!0,sanctuary:!0,inner_fire:!0,cascade_targets_holy:10,cascade_range_holy:25,poh_targets_holy:5,lw_charges:15,glyph_coh:!1,glyph_pom_holy:!0,glyph_renew_holy:!1,t4_2p_holy:!1}),i[2].attr({mastery_factor:1.5,fhaste_mul:function(){return 1.1*(this.attr("buffs.haste")?1.05:1)},daybreak:!1,bol:!1,glyph_lod:!1,t4_2p_pally:!1,cs_to_hp:!1,one_hp:!1}),i[3].attr({mastery_factor:1.25,fint:function(e){return Math.round(1.05*(this.attr("buffs.stats")?1.1:1)*(1*this.attr("stats.bint")+(e&&e.int||0)+(this.attr("buffs.intfood")?275:0)+(this.attr("buffs.intflask")?1e3:0))*(this.attr("hotw")?1.06:1))},incarnation:!1,hotw:!1,glyph_wild_growth:!0,glyph_blooming:!1,glyph_regrowth:!0,glyph_rejuv:!1,t4_2p_druid:!1}),i[4].attr({mastery_factor:3,fhaste_mul:function(){return(this.attr("ancestral_swiftness")?1.05:1)*(this.attr("buffs.haste")?1.05:1)},fsp:function(e){return Math.round((1*this.fint(e)-10+1*this.attr("stats.bweapon")+(e&&e.sp||0)+2873)*(this.attr("buffs.sp")?1.05:1))},fmast_factor:function(e){return 1+this.attr("health_deficit")/100*this.fmastp(e)},resurgence:!0,tidal_waves:!0,conductivity:!1,echo_elements:!1,ancestral_swiftness:!1,glyph_riptide:!1,health_deficit:20,chain_heal_riptide:!0,earth_shield_buff:!0,t4_2p_shaman:!1}),i[5].attr({mastery_factor:0,uplift_targets:8,revival_targets:10,t4_2p_monk:!1}),i.val_update=function(){e.Observe.startBatch(),this.each(function(e){e.val_update()}),e.Observe.stopBatch()},i}),define("text!view/specs.ejs",[],function(){return'<% specs.each(function(spec) { %>\n  <div class="spec" <%= (el) -> can.data(el, \'spec\', spec) %> >\n    <%== ImageLoader.str(spec.icon) %>\n    <a class="expandOn"><h4><%= spec.name %></h4></a>\n    <div>\n      <ul><li><a class="expandOff">Settings</a>\n      <div class="settings">\n      <%== can.view.render([\'specs\',spec.name,\'View\'].join(\'\'), {spec: spec}) %>\n      </div></li>\n      <li><a class="expandOff">Stats</a>\n      <div class="stats">\n        <label>Intellect</label><input type="input" id="int" value="<%= spec.attr(\'int\'); %>" readonly />\n        <label>Crit Percent</label><input type="input" id="crit" value="<%= spec.attr(\'crit\'); %>" readonly />\n        <label>Haste Percent</label><input type="input" id="haste" value="<%= spec.attr(\'haste\'); %>" readonly />\n        <label>Mastery Percent</label><input type="input" id="mast" value="<%= spec.attr(\'mast\'); %>" readonly />\n        <label>Spellpower</label><input type="input" id="sp" value="<%= spec.attr(\'sp\'); %>" readonly />\n      </div></li>\n      <li><a class="expandOff">Haste Points</a>\n        <div <%= (el) -> can.data(el, \'spec\', spec) %> class="haste_bar_cont" id="haste_bar_<%= spec.attr(\'name\'); %>" >\n        </div></li>\n      <li><a class="expandOff">Mana Regen</a>\n        <div class="mana_regen">\n          <label>Time duration</label><input type="input", name="interval_time" value="<%=spec.attr(\'interval_time\'); %>" />\n          <table>\n            <thead>\n            <tr><th>Source</th><th>MPS</th><th>Mana</th></tr>\n            </thead>\n            <tbody>\n              <% spec.mana_sources.each(function(source) { %>\n                <tr><td><%= source.name %></td><td><%= source.attr(\'mps\') %></td><td><%= source.attr(\'mana\') %></td></tr>\n              <% }) %>\n              <tr class="total"><td>Total</td><td><%= spec.attr(\'regen_mps\') %></td><td><%= spec.attr(\'regen_mana\') %></td>\n            </tbody>\n          </table>\n        </div></li>\n      </ul>\n    </div>\n  </div>\n<% }) %>'}),define("text!view/specsDisc.ejs",[],function(){return'<select>\n  <option value="inner_fire" <%= spec.attr(\'inner_fire\') ? \'selected="selected"\' : \'\' %>>Inner Fire</option>\n  <option value="inner_will" <%= spec.attr(\'inner_fire\') ? \'\' : \'selected="selected"\' %>>Inner Will</option>\n</select>\n<label for="grace">Assume Grace</label><input name="grace" type="checkbox" <%= spec.attr(\'grace\') ? \'checked="checked"\' : \'\'  %> />\n<label for="evang_stacks">Evangelism Stacks</label><input name="evang_stacks" type="input" value="<%= spec.attr(\'evang_stacks\')  %>" />\n<label for="archangel">Assume Archangel</label><input name="archangel" type="checkbox" <%= spec.attr(\'archangel\') ? \'checked="checked"\' : \'\'  %>  />\n<label for="cascade_targets_disc">Cascade Targets</label><input name="cascade_targets_disc" type="input" value="<%== spec.attr(\'cascade_targets_disc\') %>" />\n<label for="cascade_range_disc">Avg Cascade Range</label><input name="cascade_range_disc" type="input" value="<%== spec.attr(\'cascade_range_disc\') %>" title="Maximum effect at 30 yards" />\n<label for="poh_targets_disc">PoH Targets</label><input name="poh_targets_disc" type="input" value="<%== spec.attr(\'poh_targets_disc\') %>" />\n<label for="glyph_pom_disc">Glyph of PoM</label><input name="glyph_pom_disc" type="checkbox" <%= spec.attr(\'glyph_pom_disc\') ? \'checked="checked"\' : \'\'  %> />\n<label for="glyph_renew_disc">Glyph of Renew</label><input name="glyph_renew_disc" type="checkbox" <%= spec.attr(\'glyph_renew_disc\') ? \'checked="checked"\' : \'\'  %> /> \n<label for="glyph_penance">Glyph of Penance</label><input name="glyph_penance" type="checkbox" <%= spec.attr(\'glyph_penance\') ? \'checked="checked"\' : \'\'  %> /> \n<label for="t14_2p_disc">T14 2piece</label><input name="t14_2p_disc" type="checkbox" <%= spec.attr(\'t14_2p_disc\') ? \'checked="checked"\' : \'\'  %> /> \n<label for="rapture_interval">Rapture every: </label><input name="rapture_interval" type="input" value="<%== spec.attr(\'rapture_interval\') %>" />\n\n'}),define("text!view/specsHoly.ejs",[],function(){return'<select>\n  <option value="inner_fire" <%= spec.attr(\'inner_fire\') ? \'selected="selected"\' : \'\' %>>Inner Fire</option>\n  <option value="inner_will" <%= spec.attr(\'inner_fire\') ? \'\' : \'selected="selected"\' %>>Inner Will</option>\n</select>\n<label for="serenity">Serenity Chakra</label><input name="serenity" type="checkbox" <%= spec.attr(\'serenity\') ? \'checked="checked"\' : \'\'  %> /> \n<label for="sanctuary">Sanctuary Chakra</label><input name="sanctuary" type="checkbox" <%= spec.attr(\'sanctuary\') ? \'checked="checked"\' : \'\'  %> /> \n<label for="cascade_targets_holy">Cascade Targets</label><input name="cascade_targets_holy" type="input" value="<%== spec.attr(\'cascade_targets_holy\') %>" />\n<label for="cascade_range_holy">Avg Cascade Range</label><input name="cascade_range_holy" type="input" value="<%== spec.attr(\'cascade_range_holy\') %>" title="Maximum effect at 30 yards" />\n<label for="poh_targets_holy">PoH Targets</label><input name="poh_targets_holy" type="input" value="<%== spec.attr(\'poh_targets_holy\') %>" />\n<label for="lw_charges">LW Charges</label><input name="lw_charges" type="input" value="<%= spec.attr(\'lw_charges\') %>" />\n<label for="glyph_coh">Glyph of CoH</label><input name="glyph_coh" type="checkbox" <%= spec.attr(\'glyph_coh\') ? \'checked="checked"\' : \'\'  %>/>\n<label for="glyph_pom_holy">Glyph of PoM</label><input name="glyph_pom_holy" type="checkbox" <%= spec.attr(\'glyph_pom_holy\') ? \'checked="checked"\' : \'\'  %> /> \n<label for="glyph_renew_holy">Glyph of Renew</label><input name="glyph_renew_holy" type="checkbox" <%= spec.attr(\'glyph_renew_holy\') ? \'checked="checked"\' : \'\'  %> /> \n<label for="t14_2p_holy">T14 2piece</label><input name="t14_2p_holy" type="checkbox" <%= spec.attr(\'t14_2p_disc\') ? \'checked="checked"\' : \'\'  %> /> \n'}),define("text!view/specsDruid.ejs",[],function(){return'  <label for="serenity">Heart of the Wild</label><input name="hotw" type="checkbox" <%= spec.attr(\'hotw\') ? \'checked="checked"\' : \'\'  %> /> \n  <label for="glyph_regrow">Glyph of Regrowth</label><input name="glyph_regrowth" type="checkbox" <%= spec.attr(\'glyph_regrowth\') ? \'checked="checked"\' : \'\'  %>/>\n  <label for="glyph_wild_growth">Glyph of Wild Growth</label><input name="glyph_wild_growth" type="checkbox" <%= spec.attr(\'glyph_wild_growth\') ? \'checked="checked"\' : \'\'  %> /> \n  <label for="glyph_blooming">Glyph of Blooming</label><input name="glyph_blooming" type="checkbox" <%= spec.attr(\'glyph_blooming\') ? \'checked="checked"\' : \'\'  %> /> \n  <label for="glyph_rejuv">Glyph of Rejuvenation</label><input name="glyph_rejuv" type="checkbox" <%= spec.attr(\'glyph_rejuv\') ? \'checked="checked"\' : \'\'  %> /> \n  <label for="t14_2p_druid">T14 2piece</label><input name="t14_2p_druid" type="checkbox" <%= spec.attr(\'t14_2p_druid\') ? \'checked="checked"\' : \'\'  %> /> \n'}),define("text!view/specsPally.ejs",[],function(){return'<label for="bol">Beacon of Light</label><input name="bol" type="checkbox" <%= spec.attr(\'bol\') ? \'checked="checked"\' : \'\'  %> /> \n<label for="daybreak">Daybreak</label><input name="daybreak" type="checkbox" <%= spec.attr(\'daybreak\') ? \'checked="checked"\' : \'\'  %> /> \n<label for="glyph_lod">Glyph of Light of Dawn</label><input name="glyph_lod" type="checkbox" <%= spec.attr(\'glyph_lod\') ? \'checked="checked"\' : \'\'  %> /> \n<label for="t14_2p_pally">T14 2piece</label><input name="t14_2p_pally" type="checkbox" <%= spec.attr(\'t14_2p_pally\') ? \'checked="checked"\' : \'\'  %> /> \n<label for="cs_to_hp">1HP=CS mana cost</label><input name="cs_to_hp" type="checkbox" <%= spec.attr(\'cs_to_hp\') ? \'checked="checked"\' : \'\'  %> /> \n<label for="one_hp">HP users at 1HP</label><input name="one_hp" type="checkbox" <%= spec.attr(\'one_hp\') ? \'checked="checked"\' : \'\'  %> /> \n'}),define("text!view/specsMonk.ejs",[],function(){return'<label for="uplift_targets">Uplift Targets</label><input name="uplift_targets" type="input" value="<%== spec.attr(\'uplift_targets\') %>" />\n<label for="revival_targets">Revival Targets</label><input name="revival_targets" type="input" value="<%== spec.attr(\'revival_targets\') %>" />\n<label for="t14_2p_monk">T14 2piece</label><input name="t14_2p_monk" type="checkbox" <%= spec.attr(\'t14_2p_monk\') ? \'checked="checked"\' : \'\'  %> /> \n'}),define("text!view/specsShaman.ejs",[],function(){return'<label for="health_deficit">Health deficit percent</label><input name="health_deficit" type="input" value="<%== spec.attr(\'health_deficit\') %>" />\n<label for="resurgence">Resurgence</label><input name="resurgence" type="checkbox" <%= spec.attr(\'resurgence\') ? \'checked="checked"\' : \'\'  %> /> \n<label for="tidal_waves">Tidal Waves</label><input name="tidal_waves" type="checkbox" <%= spec.attr(\'tidal_waves\') ? \'checked="checked"\' : \'\'  %> /> \n<label for="conductivity">Conductivity</label><input name="conductivity" type="checkbox" <%= spec.attr(\'conductivity\') ? \'checked="checked"\' : \'\'  %> /> \n<label for="echo_elements">Echo of Elements</label><input name="echo_elements" type="checkbox" <%= spec.attr(\'echo_elements\') ? \'checked="checked"\' : \'\'  %> /> \n<label for="ancestral_swiftness">Ancestral Swiftness passive</label><input name="ancestral_swiftness" type="checkbox" <%= spec.attr(\'ancestral_swiftness\') ? \'checked="checked"\' : \'\'  %> /> \n<label for="glyph_riptide">Glyph of Riptide</label><input name="glyph_riptide" type="checkbox" <%= spec.attr(\'glyph_riptide\') ? \'checked="checked"\' : \'\'  %> /> \n<label for="chain_heal_riptide">CH buffed by Riptide</label><input name="chain_heal_riptide" type="checkbox" <%= spec.attr(\'chain_heal_riptide\') ? \'checked="checked"\' : \'\'  %> /> \n<label for="earth_shield_buff">Earth Shield buffs heals</label><input name="earth_shield_buff" type="checkbox" <%= spec.attr(\'earth_shield_buff\') ? \'checked="checked"\' : \'\'  %> /> \n<label for="t14_2p_shaman">T14 2piece</label><input name="t14_2p_shaman" type="checkbox" <%= spec.attr(\'t14_2p_shaman\') ? \'checked="checked"\' : \'\'  %> /> \n\n'}),define("app/control/specs",["can","text!view/specs.ejs","text!view/specsDisc.ejs","text!view/specsHoly.ejs","text!view/specsDruid.ejs","text!view/specsPally.ejs","text!view/specsMonk.ejs","text!view/specsShaman.ejs"],function(e,t,n,r,i,s,o,u){e.view.ejs("specsView",t),e.view.ejs("specsDiscView",n),e.view.ejs("specsHolyView",r),e.view.ejs("specsDruidView",i),e.view.ejs("specsPallyView",s),e.view.ejs("specsMonkView",o),e.view.ejs("specsShamanView",u);var a=e.Control({init:function(t,n){var r=this,i=n.specs,s=n.buffs,o=n.stats;i.each(function(e){e.attr("buffs",s),e.attr("stats",o)}),i.val_update(),r.element.html(e.view("specsView",{specs:i,buffs:s,stats:o})),$("li",r.element).addClass("expand").children("a").click()},"select change":function(e,t){var n=e.closest("div.spec").data("spec");n.attr("inner_fire",n.attr("inner_fire")?!1:!0),this.options.specs.val_update()},"input change":function(e,t){var n=e.attr("name"),r=e.attr("type")=="checkbox"?e.attr("checked")?!0:!1:e.attr("value");e.closest("div.spec").data("spec").attr(n,r),this.options.specs.val_update()},"{buffs} change":function(){this.options.specs.val_update()},"{stats} change":function(){this.options.specs.val_update()}});return a}),define("app/model/spell",["can"],function(e){var t=[{code:"HealDisc",name:"Heal",specid:1,base_ct:2.5,base_mana:5700,B:10645,c:1.024,img:"spell_holy_heal",aoe:!1,instant:!1,item:2050},{code:"HealSSDisc",name:"Heal Spirit Shell",specid:1,base_ct:2.5,base_mana:5700,B:10645,c:1.024,img:"ability_shaman_astralshift",aoe:!1,instant:!1,item:2050},{code:"GhealDisc",name:"Greater Heal",specid:1,base_ct:2.5,base_mana:17700,B:22725.92,c:2.19,img:"spell_holy_greaterheal",aoe:!1,instant:!1,item:2060},{code:"GhealSSDisc",name:"Greater Heal Spirit Shell",specid:1,base_ct:2.5,base_mana:17700,B:22725.92,c:2.19,img:"ability_shaman_astralshift",aoe:!1,instant:!1,item:2060},{code:"FhealDisc",name:"Flash Heal",specid:1,base_ct:1.5,base_mana:17700,B:17044.549,c:1.642,img:"spell_holy_flashheal",aoe:!1,instant:!1,item:2061},{code:"FhealSSDisc",name:"Flash Heal Spirit Shell",specid:1,base_ct:1.5,base_mana:17700,B:17044.549,c:1.642,img:"ability_shaman_astralshift",aoe:!1,instant:!1,item:2061},{code:"BhealDisc",name:"Binding Heal",specid:1,base_ct:1.5,base_mana:16200,B:12452.174,c:1.124,img:"spell_holy_bindingheal",targets:2,aoe:!1,instant:!1,item:32546},{code:"RenewDisc",name:"Renew",specid:1,base_ct:1.5,base_mana:7800,nticks:4,time_tick:3,Btick:2690,ctick:.259,img:"spell_holy_renew",aoe:!1,instant:!0,item:139},{code:"CascadeDisc",name:"Cascade",specid:1,base_ct:1.5,base_mana:27e3,targets:10,B:10108,c:.975,img:"ability_priest_cascade",aoe:!0,instant:!0,item:120785},{code:"PWSDisc",name:"Power Word: Shield",specid:1,base_ct:1.5,base_mana:18300,B:19428,c:1.871,img:"spell_holy_powerwordshield",aoe:!1,instant:!0,item:17},{code:"PoMDisc",name:"Prayer of Mending",specid:1,base_ct:1.5,base_mana:10500,targets:6,B:5919,c:.571,img:"spell_holy_prayerofmendingtga",aoe:!0,instant:!0,item:33076},{code:"PoHDisc",name:"Prayer of Healing",specid:1,base_ct:2.5,base_mana:13500,targets:5,B:6957,c:.671,img:"spell_holy_prayerofhealing02",aoe:!0,instant:!1,item:596},{code:"PoHSSDisc",name:"Prayer of Healing Spirit Shell",specid:1,base_ct:2.5,base_mana:13500,targets:5,B:6957,c:.671,img:"ability_shaman_astralshift",aoe:!0,instant:!1,item:596},{code:"HolyFireDisc",name:"Holy Fire",specid:1,base_ct:1.5,base_mana:5400,B:1135.52,c:1.11,Btick:57,ctick:.0312,nticks:7,time_tick:1,img:"spell_holy_searinglight",aoe:!1,instant:!0,item:14914},{code:"SmiteDisc",name:"Smite",specid:1,base_ct:1.5,base_mana:8100,B:2361,c:.856,img:"spell_holy_holysmite",aoe:!1,instant:!1,item:585},{code:"PenanceDisc",name:"Penance",specid:1,base_ct:2,base_mana:9300,B:6605.5,c:.635,targets:3,img:"spell_holy_penance",aoe:!1,instant:!1,item:47540},{code:"HealHoly",name:"Heal",specid:2,base_ct:2.5,base_mana:5700,B:10645,c:1.024,img:"spell_holy_heal",aoe:!1,instant:!1,item:2050},{code:"GhealHoly",name:"Greater Heal",specid:2,base_ct:2.5,base_mana:17700,B:22725.92,c:2.19,img:"spell_holy_greaterheal",aoe:!1,instant:!1,item:2060},{code:"FhealHoly",name:"Flash Heal",specid:2,base_ct:1.5,base_mana:17700,B:17044.549,c:1.642,img:"spell_holy_flashheal",aoe:!1,instant:!1,item:2061},{code:"BhealHoly",name:"Binding Heal",specid:2,base_ct:1.5,base_mana:16200,B:12452.174,c:1.124,img:"spell_holy_bindingheal",targets:2,aoe:!1,instant:!1,item:32546},{code:"RenewHoly",name:"Renew",specid:2,base_ct:1.5,base_mana:7800,nticks:4,time_tick:3,Btick:2690,ctick:.259,img:"spell_holy_renew",aoe:!1,instant:!0,item:139},{code:"PWSHoly",name:"Power Word: Shield",specid:2,base_ct:1.5,base_mana:18300,B:19428,c:1.871,img:"spell_holy_powerwordshield",aoe:!1,instant:!0,item:17},{code:"PoMHoly",name:"Prayer of Mending",specid:2,base_ct:1.5,base_mana:10500,targets:6,B:5919,c:.571,img:"spell_holy_prayerofmendingtga",aoe:!0,instant:!0,item:33076},{code:"PoHHoly",name:"Prayer of Healing",specid:2,base_ct:2.5,base_mana:13500,targets:5,B:6957,c:.671,img:"spell_holy_prayerofhealing02",aoe:!0,instant:!1,item:596},{code:"CascadeHoly",name:"Cascade",specid:2,base_ct:1.5,base_mana:27e3,targets:10,B:10108,c:.975,img:"ability_priest_cascade",aoe:!0,instant:!0,item:120785},{code:"CoHHoly",name:"Circle of Healing",specid:2,base_ct:1.5,base_mana:9600,targets:5,B:4840.5,c:.467,img:"spell_holy_circleofrenewal",aoe:!0,instant:!0,item:34861},{code:"DHHoly",name:"Divine Hymn",specid:2,base_ct:8,base_mana:18900,targets:21.5,B:7987,c:1.542,img:"spell_holy_circleofrenewal",aoe:!0,instant:!1,item:64843},{code:"LWCastHoly",name:"Lightwell Cast",specid:2,base_ct:1.5,base_mana:16200,targets:15,Btick:5735,ctick:.553,nticks:3,time_tick:2,img:"spell_holy_summonlightwell",aoe:!0,instant:!0,item:724},{code:"HWSerenityHoly",name:"Holy Word: Serenity",specid:2,base_ct:1.5,base_mana:6e3,targets:1,B:13442,c:1.3,img:"spell_holy_persuitofjustice",aoe:!1,instant:!0,item:88684},{code:"HWSanctuaryHoly",name:"Holy Word: Sanctuary",specid:2,base_ct:1.5,base_mana:18900,targets:6,Btick:504,ctick:.583,nticks:15,time_tick:2,img:"spell_holy_divineprovidence",aoe:!0,instant:!0,item:88686},{code:"HealingTouch",name:"Healing Touch",specid:4,base_ct:2.5,base_mana:17340,B:20130,c:1.86,img:"spell_nature_healingtouch",aoe:!1,instant:!1,item:5185},{code:"ForceOfNature",name:"Force of Nature",specid:4,base_ct:1.5,base_mana:0,Btick:2013,ctick:.1*1.86,nticks:6,time_tick:2.5,duration:15,targets:3,img:"ability_druid_forceofnature",aoe:!0,instant:!0,item:106737},{code:"Nourish",name:"Nourish",specid:4,base_ct:2.5,base_mana:6120,B:6649.5,c:.614,img:"ability_druid_nourish",aoe:!1,instant:!1,item:50464},{code:"Regrowth",name:"Regrowth",specid:4,base_ct:1.5,base_mana:17820,B:10383.5,c:.958,Btick:787,ctick:.073,nticks:3,time_tick:2,img:"spell_nature_resistnature",aoe:!1,instant:!1,item:8936},{code:"Rejuv",name:"Rejuvenation",specid:4,base_ct:1.5,base_mana:9600,Btick:4234,ctick:.392,nticks:4,time_tick:3,img:"spell_nature_rejuvenation",aoe:!1,instant:!0,item:774},{code:"Lifebloom",name:"Lifebloom",specid:4,base_ct:1.5,base_mana:3540,B:8150,c:.752,Btick:621,ctick:.057,nticks:15,time_tick:1,img:"inv_misc_herb_felblossom",aoe:!1,instant:!0,item:94447},{code:"WildGrowth",name:"Wild Growth",specid:4,base_ct:1.5,base_mana:13740,Btick:990,ctick:.092,nticks:7,time_tick:1,targets:5,img:"ability_druid_flourish",aoe:!0,instant:!0,item:48438},{code:"Swiftmend",name:"Swiftmend",specid:4,base_ct:1.5,base_mana:6120,Btick:13966,ctick:1.29,nticks:7,time_tick:1,targets:1,img:"inv_relics_idolofrejuvenation",aoe:!0,instant:!0,item:18562},{code:"Mushrooms",name:"Wild Mushrooms",specid:4,base_ct:4.5,base_mana:6120,B:2233,c:.207,targets:21,img:"druid_ability_wildmushroom_b",aoe:!0,instant:!0,item:102792},{code:"Tranquility",name:"Tranquility",specid:4,base_ct:8,base_mana:16260,B:9037,c:.835,Btick:1542,ctick:.142,nticks:4,time_tick:2,targets:5,img:"spell_nature_tranquility",aoe:!0,instant:!1,item:740},{code:"HolyLight",name:"Holy Light",specid:3,base_ct:2.5,base_mana:7560,B:8868.5,c:.785,img:"spell_holy_holybolt",aoe:!1,instant:!1,item:635},{code:"DivineLight",name:"Divine Light",specid:3,base_ct:2.5,base_mana:21600,B:16817.5,c:1.49,img:"spell_holy_surgeoflight",aoe:!1,instant:!1,item:82326},{code:"FlashLight",name:"Flash of Light",specid:3,base_ct:1.5,base_mana:22680,B:12606.5,c:1.12,img:"spell_holy_flashheal",aoe:!1,instant:!1,item:19750},{code:"HolyRadiance",name:"Holy Radiance",specid:3,base_ct:2.5,base_mana:21600,B:5664,c:.675,targets:4,img:"spell_paladin_divinecircle",aoe:!0,instant:!1,item:82327},{code:"HolyShock",name:"Holy Shock",specid:3,base_ct:1.5,base_mana:9600,B:9389,c:.833,img:"spell_holy_searinglight",aoe:!1,instant:!0,item:20473},{code:"WoG",name:"Word of Glory",specid:3,base_ct:1.5,base_mana:0,B:5076.5,c:.49,img:"inv_helmet_96",aoe:!1,instant:!0,item:130551},{code:"LoD",name:"Light of Dawn",specid:3,base_ct:1.5,base_mana:0,B:1637.5,c:.144,targets:6,img:"spell_paladin_lightofdawn",aoe:!0,instant:!0,item:85222},{code:"HolyPrism",name:"Holy Prism Single",specid:3,base_ct:1.5,base_mana:3240,B:16136.5,c:1.428,img:"spell_paladin_holyprism",aoe:!1,instant:!0,item:114165},{code:"HolyPrismAoE",name:"Holy Prism AoE",specid:3,base_ct:1.5,base_mana:3240,B:10881.5,c:.962,targets:5,img:"spell_paladin_holyprism",aoe:!0,instant:!0,item:114165},{code:"LightsHammer",name:"Light's Hammer",specid:3,base_ct:1.5,base_mana:0,B:3630.5,c:.321,targets:56,img:"spell_paladin_lightshammer",aoe:!0,instant:!0,item:114158},{code:"Execution",name:"Execution Sentence",specid:3,base_ct:1.5,base_mana:0,B:12989.4,c:5.936,img:"spell_paladin_executionsentence",aoe:!1,instant:!0,item:114157},{code:"EternalFlame",name:"Eternal Flame",specid:3,base_ct:1.5,base_mana:0,B:5538.5,c:.49,Btick:508,ctick:.0585,nticks:10,time_tick:3,img:"inv_torch_thrown",aoe:!1,instant:!0,item:114163},{code:"SacredShield",name:"Sacred Shield",specid:3,base_ct:1.5,base_mana:0,Btick:30,ctick:1.17,nticks:5,time_tick:6,img:"ability_paladin_blessedmending",aoe:!1,instant:!0,item:20925},{code:"HW",name:"Healing Wave",specid:5,base_ct:2.5,base_mana:5940,B:8344.5,c:.756,res_factor:1,img:"spell_nature_magicimmunity",aoe:!1,instant:!1,item:331},{code:"GHW",name:"Greater Healing Wave",specid:5,base_ct:2.5,base_mana:16140,B:15181,c:1.377,res_factor:1,img:"spell_nature_healingwavelesser",aoe:!1,instant:!1,item:77472},{code:"HSurge",name:"Healing Surge",specid:5,base_ct:1.5,base_mana:20580,B:12519,c:1.135,res_factor:.6,img:"spell_nature_healingway",aoe:!1,instant:!1,item:8004},{code:"ChainHeal",name:"Chain Heal",specid:5,base_ct:2.5,base_mana:13500,B:6325,c:.573,targets:1.417,res_factor:1.332,img:"spell_nature_healingway",aoe:!0,instant:!1,item:1064},{code:"Riptide",name:"Riptide",specid:5,base_ct:1.5,base_mana:9600,B:3735,c:.339,Btick:1764,ctick:.16,nticks:6,time_tick:3,res_factor:.6,img:"spell_nature_riptide",aoe:!1,instant:!0,item:61295},{code:"UnleashLife",name:"Unleash Life",specid:5,base_ct:1.5,base_mana:4920,B:3154,c:.286,res_factor:.6,img:"spell_shaman_unleashweapon_life",aoe:!1,instant:!0,item:73685},{code:"HST",name:"Healing Stream Totem",specid:5,base_ct:1.5,base_mana:4100,Btick:31,ctick:.3951,nticks:7.5,time_tick:2,duration:15,img:"inv_spear_04",aoe:!1,instant:!0,item:5394},{code:"HTT",name:"Healing Tide Totem",specid:5,base_ct:1.5,base_mana:4800,Btick:4932,ctick:.484,targets:5,nticks:5.5,time_tick:2,duration:11,img:"ability_shaman_healingtide",aoe:!0,instant:!0,item:108280},{code:"HealingRain",name:"Healing Rain",specid:5,base_ct:2,base_mana:25860,Btick:2170.5,ctick:.197,targets:6,nticks:5,time_tick:2,duration:10,img:"spell_nature_giftofthewaterspirit",aoe:!0,instant:!1,item:73920},{code:"Earthliving",name:"Earthliving",specid:5,base_ct:1.5,base_mana:0,Btick:3648,ctick:.083,nticks:4,time_tick:3,img:"spell_shaman_giftearthmother",aoe:!1,instant:!0,item:51945},{code:"EarthShield",name:"Earth Shield",specid:5,base_ct:1.5,base_mana:11400,B:2043,c:.13,targets:9,img:"spell_nature_skinofearth",aoe:!1,instant:!0,item:974},{code:"SoothingMist",name:"Soothing Mist",specid:6,base_ct:1,base_mana:3e3,B:2776.5,c:.1792,targets:2,img:"ability_monk_soothingmists",aoe:!1,instant:!0,item:125953},{code:"SurgingMist",name:"Surging Mist",specid:6,base_ct:1.5,base_mana:24e3,B:17242,c:1.8,img:"ability_monk_surgingmist",aoe:!1,instant:!0,item:116995},{code:"EnvelopingMist",name:"Enveloping Mist",specid:6,base_ct:1.5,base_mana:0,Btick:10948.5,ctick:.665,nticks:6,time_tick:1,img:"spell_shaman_spiritlink",aoe:!1,instant:!0,item:132120},{code:"RenewingMist",name:"Renewing Mist",specid:6,base_ct:1.5,base_mana:13800,Btick:3236,ctick:.16,nticks:6,time_tick:3,targets:3,img:"ability_monk_renewingmists",aoe:!0,instant:!0,item:119611},{code:"LifeCocoon",name:"Life Cocoon",specid:6,base_ct:1.5,base_mana:13500,B:39958,c:5.5,img:"ability_monk_chicocoon",aoe:!1,instant:!0,item:116849},{code:"Uplift",name:"Uplift",specid:6,base_ct:1.5,base_mana:0,B:7794.5,c:.68,img:"ability_monk_uplift",targets:8,aoe:!0,instant:!0,item:116670},{code:"Revival",name:"Revival",specid:6,base_ct:1.5,base_mana:21e3,B:13684,c:5,img:"spell_shaman_blessingofeternals",targets:10,aoe:!0,instant:!0,item:115310}],n={fct:function(e){return this.base_ct/(1+this.spec.fhastep(e))},fct_hp_pally:function(e){return(this.base_ct+(this.spec.cs_to_hp?1.5:0)*(this.spec.one_hp?1:3))/(1+this.spec.fhastep(e))},fmana:function(e){return this.base_mana},fmana_instant_priest:function(e){return this.base_mana*(this.spec.attr("inner_fire")?1:.85)},fmana_shaman_resurgence:function(e){return Math.round(this.base_mana-88.49*this.spec.fcrit(e)*this.res_factor*(this.spec.resurgence?1:0))},fmana_hp_pally:function(e){return(this.spec.cs_to_hp?9e3:0)*(this.spec.one_hp?1:3)},ftargets:function(e){return this.targets||1},fdirect:function(e){return(this.B+this.c*this.spec.fsp(e))*this.ftargets(e)},ftick_time:function(e){return Math.floor(1e3*(this.time_tick/(1+this.spec.fhastep(e))+5e-4))/1e3},fnticks:function(e){return Math.round(this.nticks*this.time_tick/this.ftick_time(e))},fnticks_shaman_aoe:function(e){return 1+Math.ceil(this.duration*(1+this.spec.fhastep(e))/this.time_tick)},fhot:function(e){return(this.Btick+this.ctick*this.spec.fsp(e))*this.ftargets(e)*this.fnticks(e)},fbase:function(e){return this.nticks?this.fhot(e):this.fdirect(e)},fbase_disc:function(e){return(this.nticks?this.fhot(e):this.fdirect(e))*(this.spec.grace?1.3:1)*(this.spec.archangel?1.25:1)},fbase_disc_no_archangel:function(e){return(this.nticks?this.fhot(e):this.fdirect(e))*(this.spec.grace?1.3:1)},fbase_holy_sth:function(e){return(this.nticks?this.fhot(e):this.fdirect(e))*(this.spec.serenity?1.25:1)},fbase_holy_aoe:function(e){return(this.nticks?this.fhot(e):this.fdirect(e))*(this.spec.sanctuary?1.25:1)},fbase_pally:function(e){return(this.nticks?this.fhot(e):this.fdirect(e))*1.05*1.25},fbase_pally_hp:function(e){return(this.nticks?this.fhot(e):this.fdirect(e))*1.05*1.25*(this.spec.one_hp?1:3)},fbase_shaman:function(e){return(this.nticks?this.fhot(e):this.fdirect(e))*1.25},fheal:function(e){return this.fbase(e)*(1+(-1+2*(this.spec.critmeta?1.03:1))*this.spec.fcritp(e))*(1+1*this.spec.fmastp(e))},fheal_pally:function(e){return this.fbase(e)*(1+(-1+2*(this.spec.critmeta?1.03:1))*this.spec.fcritp(e))*(1+(this.spec.bol?.5:0)+this.spec.fmastp(e))},fheal_shaman:function(e){return this.fbase(e)*(1+(-1+2*(this.spec.critmeta?1.03:1))*this.spec.fcritp(e))*this.spec.fmast_factor(e)},fheal_shaman_aa:function(e,t){return(this.spec.earth_shield_buff?1.2:1)*this.fbase(e)*this.spec.fmast_factor(e)*(1+(-1+2*(this.spec.critmeta?1.03:1)*1.3*(t||this.spec.fcritp(e))))},fheal_disc:function(e){var t=.5;return this.fbase(e)*(1+(-1+2*(this.spec.critmeta?1.03:1)*(1+t*(1+this.spec.fmastp(e))))*this.spec.fcritp(e))},fheal_disc_atonement:function(e){var t=.5;return this.fbase(e)*(1+(-1+2*(this.spec.critmeta?1.03:1)*(this.spec.critmeta?1.03:1)*(1+t*(1+this.spec.fmastp(e))))*this.spec.fcritp(e))},fheal_spirit_shell:function(e){return this.fbase(e)*(1+this.spec.fmastp(e))*(1+this.spec.fcritp(e))*(1+.3*this.spec.fcritp(e))},fheal_sth_holy:function(e){return this.fbase(e)*(1+(-1+2*(this.spec.critmeta?1.03:0))*((this.spec.serenity?.25:0)+this.spec.fcritp(e)))*(1+this.spec.fmastp(e))},fheal_living_seed:function(e){return this.fbase(e)*(1+this.spec.fmastp(e))*(1+(-1+2*(this.spec.critmeta?1.03:1)*1.3)*this.spec.fcritp(e))},fhps:function(e){return this.fheal(e)/this.fct(e)},fhpm:function(e){return this.fheal(e)/this.fmana(e)},fhpm_nomana:function(e){return 0},fhpm_hp_pally_nomana:function(e){return this.spec.cs_to_hp?this.fheal(e)/this.fmana():0},fmps:function(e){return this.fmana(e)/this.fct(e)},val_update:function(t){e.Observe.startBatch(),this.attr({ct:Math.round(this.fct()*100)/100,mana:Math.round(this.fmana()),base_heal:Math.round(this.fbase()),heal:Math.round(this.fheal()),hps:Math.round(this.fhps()),hpm:Math.round(100*this.fhpm())/100,mps:Math.round(this.fmps())}),e.Observe.stopBatch()}},r=t.length,i=new e.Observe.List([]);for(var s=0;s<r;s++){var o=new e.Observe(e.extend(t[s],n));o.id=s,i.push(o)}return i.val_update=e.proxy(function(t){e.Observe.startBatch(),this.each(function(e){(!t||e.specid==t.id)&&e.val_update()}),e.Observe.stopBatch()},i),i.find=function(e){var t=typeof e=="string"?function(t){return t.code===e}:function(t){return t.id===e},n=this.length;while(n--)if(t(this[n]))return this[n];return!1},i.each(function(e){e.mask=1<<e.specid>>1|1<<(e.aoe?6:7)|1<<(e.instant?8:9),e.specid==1?(e.fbase=e.fbase_disc,e.fheal=e.fheal_disc):e.specid==3?(e.fbase=e.fbase_pally,e.fheal=e.fheal_pally):e.specid==5&&(e.fheal=e.fheal_shaman)}),i.find("RenewDisc").attr({fmana:function(e){return this.fmana_instant_priest(e)},fnticks:function(e){return Math.round((this.nticks-(this.spec.attr("glyph_renew_disc")?1:0))*this.time_tick/this.ftick_time(e))},fhot:function(e){return(this.spec.attr("glyph_renew_disc")?1+1/3:1)*(this.Btick+this.ctick*this.spec.fsp(e))*this.ftargets(e)*this.fnticks(e)}}),i.find("CascadeDisc").attr({fmana:function(e){return this.fmana_instant_priest(e)},ftargets:function(e){return this.spec.cascade_targets_disc*(.4+Math.min(this.spec.cascade_range_disc,30)*.02)}}),i.find("PWSDisc").attr({fmana:function(e){return this.fmana_instant_priest(e)},fbase:function(e){return this.fdirect(e)*(this.spec.attr("archangel")?1.25:1)},fheal:function(e){return this.fbase(e)*(1+this.spec.fmastp(e))}}),i.find("PoMDisc").attr({fmana:function(e){return this.fmana_instant_priest(e)},fdirect:function(e){return(this.B+this.c*this.spec.fsp(e))*(this.spec.attr("glyph_pom_disc")?5.6:6)}}),i.find("PoHDisc").attr({fheal:function(e){var t=.5;return this.fbase(e)*(1+(-1+2*(this.spec.critmeta?1.03:1))*this.spec.fcritp(e))*(1+t*(1+this.spec.fmastp(e)))},ftargets:function(e){return 1*this.spec.poh_targets_disc}}),i.find("HealSSDisc").attr({fheal:function(e){return this.fheal_spirit_shell(e)}}),i.find("FhealDisc").attr({fmana:function(e){return Math.round(this.base_mana*(this.spec.attr("t14_2p_disc")?.9:1))}}),i.find("FhealSSDisc").attr({fheal:function(e){return this.fheal_spirit_shell(e)},fmana:function(e){return Math.round(this.base_mana*(this.spec.attr("t14_2p_disc")?.9:1))}}),i.find("GhealSSDisc").attr({fheal:function(e){return this.fheal_spirit_shell(e)}}),i.find("PoHSSDisc").attr({fheal:function(e){return this.fbase(e)*(1+this.spec.fcritp(e))*(1+this.spec.fmastp(e))*1.3},ftargets:function(e){return 1*this.spec.poh_targets_disc}}),i.find("HolyFireDisc").attr({fbase:function(e){return(this.fhot(e)+this.fdirect(e))*(this.spec.grace?1.3:1)*(this.spec.archangel?1.25:1)*(1+this.spec.evang_stacks*.04)},fheal:function(e){return this.fheal_disc_atonement(e)},fmana:function(e){return this.base_mana*(1-this.spec.evang_stacks*.06)}}),i.find("SmiteDisc").attr({fbase:function(e){return this.fdirect(e)*(this.spec.grace?1.3:1)*(this.spec.archangel?1.25:1)*(1+this.spec.evang_stacks*.04)*1.2},fheal:function(e){return this.fheal_disc_atonement(e)},fmana:function(e){return this.base_mana*(1-this.spec.evang_stacks*.06)}}),i.find("PenanceDisc").attr({fbase:function(e){return this.fdirect(e)*(this.spec.grace?1.3:1)*(this.spec.archangel?1.25:1)*(1+this.spec.evang_stacks*.04)},fheal:function(e){return this.fheal_disc_atonement(e)},fmana:function(e){return this.base_mana*(1-this.spec.evang_stacks*.06)}}),$.each(["HealHoly","FhealHoly","GhealHoly","BhealHoly"],function(e,t){i.find(t).attr({fbase:function(e){return this.fbase_holy_sth(e)},fheal:function(e){return this.fheal_sth_holy(e)}})}),i.find("FhealHoly").attr({fmana:function(e){return Math.round(this.base_mana*(this.spec.attr("t14_2p_holy")?.9:1))}}),$.each(["PoHHoly","DHHoly","CoHHoly","PoMHoly","HWSanctuaryHoly"],function(e,t){i.find(t).attr({fbase:function(e){return this.fbase_holy_aoe(e)}})}),i.find("HWSerenityHoly").attr({fbase:function(e){return this.fbase_holy_sth(e)},fmana:function(e){return this.fmana_instant_priest(e)}}),i.find("CascadeHoly").attr({ftargets:function(e){return this.spec.cascade_targets_holy*(.4+Math.min(this.spec.cascade_range_holy,30)*.02)}}),i.find("PoHHoly").attr({ftargets:function(e){return 1*this.spec.poh_targets_holy}}),i.find("PoMHoly").attr({fmana:function(e){return this.fmana_instant_priest(e)},fdirect:function(e){return(this.B+this.c*this.spec.fsp(e))*(this.spec.attr("glyph_pom_holy")?5.6:6)}}),i.find("RenewHoly").attr({fmana:function(e){return this.fmana_instant_priest(e)},fnticks:function(e){return Math.round((this.nticks-(this.spec.attr("glyph_renew_holy")?1:0))*this.time_tick/this.ftick_time(e))},fhot:function(e){return(this.spec.attr("glyph_renew_holy")?1+1/3:1)*(this.Btick+this.ctick*this.spec.fsp(e))*this.ftargets(e)*this.fnticks(e)},fbase:function(e){return this.fhot(e)*1.15*1.15*(this.spec.sanctuary?1.25:1)},fct:function(e){return 1}}),i.find("PWSHoly").attr({fmana:function(e){return this.fmana_instant_priest(e)},fheal:function(e){return this.fbase(e)}}),i.find("LWCastHoly").attr({fmana:function(e){return this.fmana_instant_priest(e)},fheal:function(e){return this.fbase(e)},fhot:function(e){return(this.Btick+this.ctick*this.spec.fsp(e))*this.spec.lw_charges*this.fnticks(e)}}),i.find("Nourish").attr({fct:function(e){return(this.base_ct-(this.spec.attr("glyph_rejuv")?.5:0))/(1+this.spec.fhastep(e))},fbase:function(e){return this.fdirect(e)*1.2},fheal:function(e){return this.fheal_living_seed(e)}}),i.find("HealingTouch").attr({fheal:function(e){return this.fheal_living_seed(e)}}),i.find("Regrowth").attr({fbase:function(e){return this.fdirect(e)+(this.spec.attr("glyph_regrowth")?0:this.fhot(e))},fheal:function(e){var t=this.spec.attr("glyph_regrowth")?1:Math.min(this.spec.fcritp(e)+.6,1);return(1+this.spec.fmastp(e))*(this.fbase(e)*(1+(-1+2*t*(this.spec.critmeta?1.03:1)))+this.fdirect(e)*(this.spec.critmeta?1.03:1)*.6*t)}}),i.find("Rejuv").attr({fmana:function(e){return Math.round(this.base_mana*(this.spec.attr("t14_2p_druid")?.9:1))},fct:function(e){return 1},fnticks:function(e){return 1+Math.round(this.nticks*this.time_tick/this.ftick_time(e))}}),i.find("Lifebloom").attr({fnticks:function(e){return Math.round((this.nticks-(this.spec.attr("glyph_blooming")?5:0))*this.time_tick/this.ftick_time(e))},fdirect:function(e){return(this.B+this.c*this.spec.fsp(e))*(this.spec.attr("glyph_blooming")?1.5:1)},fbase:function(e){return this.fdirect(e)+this.fhot(e)}}),i.find("WildGrowth").attr({fhot:function(e){return(this.Btick+this.ctick*this.spec.fsp(e))*(5+(this.spec.attr("glyph_wild_growth")?1:0)+(this.spec.attr("incarnation")?2:0))*this.fnticks(e)}}),i.find("Swiftmend").attr({fnticks:function(e){return 1+.36*Math.round(this.nticks*this.time_tick/this.ftick_time(e))},fheal:function(e){return(1+this.spec.fmastp(e))*(this.fbase(e)*(1+(-1+2*(this.spec.critmeta?1.03:1))*this.spec.fcritp(e))+(this.Btick+this.ctick*this.spec.fsp(e))*.6*(this.spec.critmeta?1.03:1)*this.spec.fcritp(e))}}),i.find("Mushrooms").attr({fheal:function(e){return this.fbase(e)*(1+(-1+2*(this.spec.critmeta?1.03:1))*this.spec.fcritp(e))}}),i.find("Tranquility").attr({fheal:function(e){var t=this.fnticks(e);return(this.fdirect(e)*t+(-3+3*t+3*t)*(this.Btick+this.ctick*this.spec.fsp(e))*this.ftargets(e))*(1+this.spec.fmastp(e))*(1+(-1+2*(this.spec.critmeta?1.03:1))*this.spec.fcritp(e))}}),i.find("ForceOfNature").attr({fnticks:function(e){return this.fnticks_shaman_aoe(e)},fhpm:function(e){return this.fhpm_nomana(e)}}),i.find("HolyLight").attr({fheal:function(e){return this.fbase(e)*(1+(-1+2*(this.spec.critmeta?1.03:1))*this.spec.fcritp(e))*(1+(this.spec.bol?1:0)+this.spec.fmastp(e))}}),i.find("HolyShock").attr({fheal:function(e){var t=.25+this.spec.fcritp(e);return(1+(this.spec.bol?.5:0)+this.spec.fmastp(e))*this.fbase(e)*(1+(-1+2*(this.spec.critmeta?1.03:1))*t)*(this.spec.attr("daybreak")?2:1)}}),i.find("WoG").attr({fct:function(e){return this.fct_hp_pally(e)},fmana:function(e){return this.fmana_hp_pally(e)},fhpm:function(e){return this.fhpm_hp_pally_nomana(e)},fbase:function(e){return this.fbase_pally_hp(e)}}),i.find("HolyRadiance").attr({fmana:function(e){return Math.round(this.base_mana*(this.spec.attr("t14_2p_pally")?.9:1))},fheal:function(e){return this.fbase(e)*(1+(-1+2*(this.spec.critmeta?1.03:1))*this.spec.fcritp(e))*(1+(this.spec.bol?.15:0)+this.spec.fmastp(e))}}),i.find("LoD").attr({fct:function(e){return this.fct_hp_pally(e)},fmana:function(e){return this.fmana_hp_pally(e)},fhpm:function(e){return this.fhpm_hp_pally_nomana(e)},fbase:function(e){return this.fbase_pally_hp(e)},ftargets:function(e){return this.targets-(this.spec.attr("glyph_lod")?2:0)},fdirect:function(e){return(this.B+this.c*this.spec.fsp(e))*this.ftargets(e)*(this.spec.attr("glyph_lod")?1.25:1)},fheal:function(e){return this.fbase(e)*(1+(-1+2*(this.spec.critmeta?1.03:1))*this.spec.fcritp(e))*(1+(this.spec.bol?.15:0)+this.spec.fmastp(e))}}),i.find("LightsHammer").attr({fhpm:function(e){return this.fhpm_nomana(e)},fheal:function(e){return this.fbase(e)*(1+(-1+2*(this.spec.critmeta?1.03:1))*this.spec.fcritp(e))*(1+(this.spec.bol?.15:0))}}),i.find("Execution").attr({fhpm:function(e){return this.fhpm_nomana(e)}}),i.find("EternalFlame").attr({fct:function(e){return this.fct_hp_pally(e)},fmana:function(e){return this.fmana_hp_pally(e)},fhpm:function(e){return this.fhpm_hp_pally_nomana(e)},fbase:function(e){return(this.fhot(e)+this.fdirect(e))*1.05*1.25*(this.spec.one_hp?1:3)}}),i.find("SacredShield").attr({fhpm:function(e){return this.fhpm_nomana(e)},fbase:function(e){return this.fhot(e)}}),i.find("HolyPrism").attr({fheal:function(e){return this.fbase(e)*(1+(-1+2*(this.spec.critmeta?1.03:1))*this.spec.fcritp(e))*(1+(this.spec.bol?.15:0)+this.spec.fmastp(e))}}),i.find("HolyPrismAoE").attr({fheal:function(e){return this.fbase(e)*(1+(-1+2*(this.spec.critmeta?1.03:1))*this.spec.fcritp(e))*(1+(this.spec.bol?.15:0)+this.spec.fmastp(e))}}),i.find("HW").attr({fmana:function(e){return this.fmana_shaman_resurgence(e)},fheal:function(e){return this.fheal_shaman_aa(e)},fct:function(e){return this.base_ct/(1+this.spec.fhastep(e))*(this.spec.attr("tidal_waves")?.7:1)}}),i.find("GHW").attr({fmana:function(e){return Math.round(this.base_mana*(this.spec.attr("t14_2p_shaman")?.9:1)-8849*this.spec.fcritp(e)*this.res_factor*(this.spec.resurgence?1:0))},fheal:function(e){return this.fheal_shaman_aa(e)},fct:function(e){return this.base_ct/(1+this.spec.fhastep(e))*(this.spec.attr("tidal_waves")?.7:1)}}),i.find("HSurge").attr({fmana:function(e){var t=this.spec.fcritp(e)+(this.spec.attr("tidal_waves")?.3:0);return Math.round(this.base_mana-t*8849*.6*(this.spec.attr("resurgence")?1:0))},fheal:function(e){return this.fheal_shaman_aa(e,this.spec.fcritp(e)+(this.spec.attr("tidal_waves")?.3:0))}}),i.find("ChainHeal").attr({fmana:function(e){return this.fmana_shaman_resurgence(e)},ftargets:function(e){return this.targets+(this.spec.earth_shield_buff?.2:0)},fbase:function(e){return this.fdirect(e)*1.25*(this.spec.attr("chain_heal_riptide")?1.25:1)}}),i.find("Riptide").attr({fmana:function(e){return this.fmana_shaman_resurgence(e)},fdirect:function(e){return(this.B+this.c*this.spec.fsp(e))*(this.spec.attr("glyph_riptide")?.1:1)},fbase:function(e){return this.fhot(e)+this.fdirect(e)},fheal:function(e){return this.fheal_shaman_aa(e)}}),i.find("UnleashLife").attr({fmana:function(e){return this.fmana_shaman_resurgence(e)},fheal:function(e){return this.fheal_shaman_aa(e)}}),i.find("HST").attr({fnticks:function(e){return this.fnticks_shaman_aoe(e)}}),i.find("HTT").attr({fnticks:function(e){return this.fnticks_shaman_aoe(e)}}),i.find("HealingRain").attr({fnticks:function(e){return 1+this.nticks*this.time_tick/(Math.floor(1e3*this.time_tick/(1+this.spec.fhastep(e))+5e-4)/1e3)}}),i.find("Earthliving").attr({fhpm:function(e){return this.fhpm_nomana(e)}}),i.find("EnvelopingMist").attr({fhpm:function(e){return this.fhpm_nomana(e)}}),i.find("SurgingMist").attr({fmana:function(e){return this.base_mana*(this.spec.attr("t14_2p_monk")?.9:1)}}),i.find("Uplift").attr({fhpm:function(e){return this.fhpm_nomana(e)}}),i}),define("app/util/sorter",["can"],function(e){var t=function(e,t){return _partition=function(n,r){var i=e[r],s=n-1;for(var o=n;o<r;o++)if(t(e[o],e[r])){s++;var u=e[s];e[s]=e[o],e[o]=u}return s++,e[r]=e[s],e[s]=i,s},_qsort=function(e,t){if(e<t){var n=_partition(e,t);_qsort(e,n-1),_qsort(n+1,t)}},_qsort(0,e.length-1),e};return t}),define("text!view/spells.ejs",[],function(){return"<h4>Spells</h4>\n<table id=\"spellTable\" <%= (el) -> can.data(el, 'spells', spells) %>>\n  <thead>\n    <th id=\"th_spec\">Spec</th>\n    <th id=\"th_name\">Name</th>\n    <th id=\"th_ct\">Cast Time</th>\n    <th id=\"th_mana\">Mana</th>\n    <th id=\"th_base\">Base Heal</th>\n    <th id=\"th_heal\">Average Heal</th>\n    <th id=\"th_hps\" class=\"sort_desc\">HPS</th>\n    <th id=\"th_hpm\">HPM</th>\n    <th id=\"th_mps\">MPS</th>\n  </thead>\n  <tbody>\n<% spells.each(function(spell) { %>\n  <tr class=\"spell spell_<%= spell.spec.name %>\" <%= (el) -> can.data(el, 'spell', spell) %> >\n    <td class=\"spec\"><%== ImageLoader.str(spell.spec.icon) %></td>\n    <td class=\"name\"><%== ImageLoader.str(spell.img) %>\n      <a href=\"http://www.wowhead.com/spell=<%= spell.item %>\" target=\"_blank\"><%= spell.name %></a></td>\n    <td <%= (el) -> can.data(el, 'colinfo', {fun: 'fct', name: 'Cast Time'}) %>><%= spell.attr('ct') %></td>\n    <td <%= (el) -> can.data(el, 'colinfo', {fun: 'fmana', name: 'Mana Cost'}) %>><%= spell.attr('mana') %></td>\n    <td <%= (el) -> can.data(el, 'colinfo', {fun: 'fbase', name: 'Base Heal'}) %>><%= spell.attr('base_heal') %></td>\n    <td <%= (el) -> can.data(el, 'colinfo', {fun: 'fheal', name: 'Average Heal'}) %>><%= spell.attr('heal') %></td>\n    <td <%= (el) -> can.data(el, 'colinfo', {fun: 'fhps', name: 'HPS'}) %>><%= spell.attr('hps') %></td>\n    <td <%= (el) -> can.data(el, 'colinfo', {fun: 'fhpm', name: 'HPM'}) %>><%= spell.attr('hpm') %></td>\n    <td <%= (el) -> can.data(el, 'colinfo', {fun: 'fmps', name: 'MPS'}) %>><%= spell.attr('mps') %></td>\n  </tr>\n<% }) %>\n  </tbody>\n</table>"}),define("app/control/spells",["can","app/util/sorter","text!view/spells.ejs"],function(e,t,n){e.view.ejs("spellsView",n);var r=e.Control({init:function(t,n){var r=this,i=r.options.spells,s=r.options.specs;i.each(function(e){s.each(function(t){t.id==e.specid&&e.attr("spec",t)})}),r.options.sort={attr:"hps",dir:"desc"},this.options.spells.val_update(),this.sort(),r.element.html(e.view("spellsView",{spells:i}))},sort:function(e){var n=this.options.batchNum;if(!e||!e.batchNum||e.batchNum!==n){e&&(this.options.batchNum=e.batchNum);var r=this.options.sort.attr,i=this.options.sort.dir=="desc"?function(e,t){return e[r]>=t[r]}:function(e,t){return e[r]<=t[r]},s=this.options.spells;setTimeout(function(){t(s,i),s.push(s[0]),s.pop()},30)}},"{specs} change":function(e,t){this.options.spells.val_update(t.target),this.sort(t)},"thead th click":function(e,t){var n=e.attr("id").replace("th_",""),r=this.options.sort;n==r.attr?(r.dir=r.dir=="asc"?"desc":"asc",e.toggleClass("sort_asc sort_desc")):($(e).add("#th_"+r.attr).toggleClass("sort_"+r.dir),r.attr=n),this.sort(t)}});return r}),define("text!view/filtering.ejs",[],function(){return'<div><a class="expandOff"><h4>Filters</h4></a>\n<div>\n  <label for="filter_allspecs">All Specs</label><input id="filter_allspecs" type="checkbox" <%= filters.attr(\'allspecs\') ? \'checked="checked"\' : \'\' %> />\n  <label for="filter_disc"><%== ImageLoader.str(\'spell_holy_powerwordshield\') %></label><input id="filter_disc" type="checkbox" <%= filters.attr(\'disc\') ? \'checked="checked"\' : \'\' %> />\n  <label for="filter_holy"><%== ImageLoader.str(\'spell_holy_guardianspirit\') %>\n</label><input id="filter_holy" type="checkbox" <%= filters.attr(\'holy\') ? \'checked="checked"\' : \'\' %> />\n  <label for="filter_pally"><%== ImageLoader.str(\'spell_holy_holybolt\') %>\n</label><input id="filter_pally" type="checkbox" <%= filters.attr(\'pally\') ? \'checked="checked"\' : \'\' %> />\n  <label for="filter_druid"><%== ImageLoader.str(\'spell_nature_healingtouch\') %>\n</label><input id="filter_druid" type="checkbox" <%= filters.attr(\'druid\') ? \'checked="checked"\' : \'\' %> />\n  <label for="filter_shaman"><%== ImageLoader.str(\'spell_nature_healingwavegreater\') %>\n</label><input  id="filter_shaman" type="checkbox" <%= filters.attr(\'shaman\') ? \'checked="checked"\' : \'\' %> />\n  <label for="filter_monk"><%== ImageLoader.str(\'spell_monk_mistweaver_spec\') %>\n</label><input id="filter_monk" type="checkbox" <%= filters.attr(\'monk\') ? \'checked="checked"\' : \'\' %> />\n  <label for="filter_aoe">AoE</label><input id="filter_aoe" type="checkbox" <%= filters.attr(\'aoe\') ? \'checked="checked"\' : \'\' %> />\n  <label for="filter_single">Single Target</label><input id="filter_single" type="checkbox" <%= filters.attr(\'single\') ? \'checked="checked"\' : \'\' %> />\n  <label for="filter_instant">Instant Cast</label><input id="filter_instant" type="checkbox" <%= filters.attr(\'instant\') ? \'checked="checked"\' : \'\' %> />\n  <label for="filter_casttime">Cast Time</label><input id="filter_casttime" type="checkbox" <%= filters.attr(\'casttime\') ? \'checked="checked"\' : \'\' %> />\n</div>\n</div>'}),define("app/util/filtering",["can","text!view/filtering.ejs"],function(e,t){e.view.ejs("filterView",t);var n=["disc","holy","pally","druid","shaman","monk"],r=n.concat(["aoe","single","instant","casttime"]),i=e.Control({init:function(t,n){var r=this;r.options=n,r.options.filters=new e.Observe({allspecs:!0,disc:!0,holy:!0,pally:!0,druid:!0,shaman:!0,monk:!0,aoe:!0,single:!0,instant:!0,casttime:!0}),r.options.fullmask=1023,r.options.curr_mask=0,r.element.data("filters",r.options.filters),r.element.append(e.view("filterView",r.options)),setInterval(function(){r.update(r)},30)},update:function(e){var t=e.options.curr_mask,n=e.options.filters;$("tr.spell",e.options.table).each(function(e,n){($(n).data("spell").mask&t)==0?$(n).show():$(n).hide()}),$("div.spec",e.options.specs).each(function(e,t){n[$(t).data("spec").name.toLowerCase()]?$(t).show():$(t).hide()})},"input click":function(e,t){var r=this.options.filters,i=e.attr("id").split("_")[1];r.attr(i,!r.attr(i));var s=r.attr(i);i=="allspecs"&&$.each(n,function(e,t){r.attr(t,s)})},setSpec:function(e){var t=this.options.filters;t.attr("allspecs",!1),$.each(n,function(n,r){t.attr(r,r==e)}),$(["#filter",e].join("_")).click().click()},change:function(){imask=0;var e=this.options.filters;$.each(r,function(t,n){e.attr(n)&&(imask+=1<<t)}),imask=~imask&this.options.fullmask,this.options.curr_mask=imask}});return i}),define("text!view/delta_view.ejs",[],function(){return'<span>Stat Amount: <input type="input" value="<%= delta %>" /></span>\n<span>Measure: <%= measure %></span>\n\n<table>\n<thead>\n  <th>Stat</th><th>Relative Change</th><th>Weight</th>\n</thead>\n<tbody>\n  <tr><td>Int    </td><td><%= results.int %>%</td><td><%= Math.round(results.int /results.sp * 100)/100 %></td></tr>\n  <tr><td>Sp     </td><td><%= results.sp %>%</td><td><%= Math.round(results.sp /results.sp * 100)/100 %></td></tr>\n  <tr><td>Crit   </td><td><%= results.crit %>%</td><td><%= Math.round(results.crit /results.sp * 100)/100 %></td></tr>\n  <tr><td>Mastery</td><td><%= results.mast %>%</td><td><%= Math.round(results.mast /results.sp * 100)/100 %></td></tr>\n  <tr><td>Haste  </td><td><%= results.haste %>%</td><td><%= Math.round(results.haste /results.sp * 100)/100 %></td></tr>\n  <tr><td>Spirit  </td><td><%= results.spi %>%</td><td><%= Math.round(results.spi /results.sp * 100)/100 %></td></tr>\n</tbody>\n</table>'}),define("app/util/delta_viewer",["can","text!view/delta_view.ejs"],function(e,t){e.view.ejs("deltaViewerView",t);var n=e.Control({init:function(e,t){var n=this;t.delta=t.delta||1e3;var r=t.source},"{source} tr td mouseover":function(t,n){if(!$(t).data("colinfo"))return;var r=$(t).closest("tr").data("spell")||$(t).closest("tr").data("rotation"),i=this.options.delta;this.options.measure=$(t).data("colinfo").name;var s=$(t).data("colinfo").fun,o=r[s]();this.options.base=o;var u={};$.each(["int","sp","crit","haste","mast","spi"],function(e,t){var n={};n[t]=i,u[t]=Math.round((r[s](n)-o)/o*1e4)/100}),this.options.results=u,this.element.html(e.view("deltaViewerView",this.options))},"input change":function(e,t){this.options.delta=$(e).attr("value")*1}});return n}),!function(e,t,n){function o(e,n){var r=t.createElement(e||"div"),i;for(i in n)r[i]=n[i];return r}function u(e){for(var t=1,n=arguments.length;t<n;t++)e.appendChild(arguments[t]);return e}function f(e,t,n,r){var o=["opacity",t,~~(e*100),n,r].join("-"),u=.01+n/r*100,f=Math.max(1-(1-e)/t*(100-u),e),l=s.substring(0,s.indexOf("Animation")).toLowerCase(),c=l&&"-"+l+"-"||"";return i[o]||(a.insertRule("@"+c+"keyframes "+o+"{"+"0%{opacity:"+f+"}"+u+"%{opacity:"+e+"}"+(u+.01)+"%{opacity:1}"+(u+t)%100+"%{opacity:"+e+"}"+"100%{opacity:"+f+"}"+"}",a.cssRules.length),i[o]=1),o}function l(e,t){var i=e.style,s,o;if(i[t]!==n)return t;t=t.charAt(0).toUpperCase()+t.slice(1);for(o=0;o<r.length;o++){s=r[o]+t;if(i[s]!==n)return s}}function c(e,t){for(var n in t)e.style[l(e,n)||n]=t[n];return e}function h(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)e[i]===n&&(e[i]=r[i])}return e}function p(e){var t={x:e.offsetLeft,y:e.offsetTop};while(e=e.offsetParent)t.x+=e.offsetLeft,t.y+=e.offsetTop;return t}var r=["webkit","Moz","ms","O"],i={},s,a=function(){var e=o("style",{type:"text/css"});return u(t.getElementsByTagName("head")[0],e),e.sheet||e.styleSheet}(),d={lines:12,length:7,width:5,radius:10,rotate:0,corners:1,color:"#000",speed:1,trail:100,opacity:.25,fps:20,zIndex:2e9,className:"spinner",top:"auto",left:"auto",position:"relative"},v=function m(e){if(!this.spin)return new m(e);this.opts=h(e||{},m.defaults,d)};v.defaults={},h(v.prototype,{spin:function(e){this.stop();var t=this,n=t.opts,r=t.el=c(o(0,{className:n.className}),{position:n.position,width:0,zIndex:n.zIndex}),i=n.radius+n.length+n.width,u,a;e&&(e.insertBefore(r,e.firstChild||null),a=p(e),u=p(r),c(r,{left:(n.left=="auto"?a.x-u.x+(e.offsetWidth>>1):parseInt(n.left,10)+i)+"px",top:(n.top=="auto"?a.y-u.y+(e.offsetHeight>>1):parseInt(n.top,10)+i)+"px"})),r.setAttribute("aria-role","progressbar"),t.lines(r,t.opts);if(!s){var f=0,l=n.fps,h=l/n.speed,d=(1-n.opacity)/(h*n.trail/100),v=h/n.lines;(function m(){f++;for(var e=n.lines;e;e--){var i=Math.max(1-(f+e*v)%h*d,n.opacity);t.opacity(r,n.lines-e,i,n)}t.timeout=t.el&&setTimeout(m,~~(1e3/l))})()}return t},stop:function(){var e=this.el;return e&&(clearTimeout(this.timeout),e.parentNode&&e.parentNode.removeChild(e),this.el=n),this},lines:function(e,t){function i(e,r){return c(o(),{position:"absolute",width:t.length+t.width+"px",height:t.width+"px",background:e,boxShadow:r,transformOrigin:"left",transform:"rotate("+~~(360/t.lines*n+t.rotate)+"deg) translate("+t.radius+"px"+",0)",borderRadius:(t.corners*t.width>>1)+"px"})}var n=0,r;for(;n<t.lines;n++)r=c(o(),{position:"absolute",top:1+~(t.width/2)+"px",transform:t.hwaccel?"translate3d(0,0,0)":"",opacity:t.opacity,animation:s&&f(t.opacity,t.trail,n,t.lines)+" "+1/t.speed+"s linear infinite"}),t.shadow&&u(r,c(i("#000","0 0 4px #000"),{top:"2px"})),u(e,u(r,i(t.color,"0 0 1px rgba(0,0,0,.1)")));return e},opacity:function(e,t,n){t<e.childNodes.length&&(e.childNodes[t].style.opacity=n)}}),function(){function e(e,t){return o("<"+e+' xmlns="urn:schemas-microsoft.com:vml" class="spin-vml">',t)}var t=c(o("group"),{behavior:"url(#default#VML)"});!l(t,"transform")&&t.adj?(a.addRule(".spin-vml","behavior:url(#default#VML)"),v.prototype.lines=function(t,n){function s(){return c(e("group",{coordsize:i+" "+i,coordorigin:-r+" "+ -r}),{width:i,height:i})}function l(t,i,o){u(a,u(c(s(),{rotation:360/n.lines*t+"deg",left:~~i}),u(c(e("roundrect",{arcsize:n.corners}),{width:r,height:n.width,left:n.radius,top:-n.width>>1,filter:o}),e("fill",{color:n.color,opacity:n.opacity}),e("stroke",{opacity:0}))))}var r=n.length+n.width,i=2*r,o=-(n.width+n.length)*2+"px",a=c(s(),{position:"absolute",top:o,left:o}),f;if(n.shadow)for(f=1;f<=n.lines;f++)l(f,-2,"progid:DXImageTransform.Microsoft.Blur(pixelradius=2,makeshadow=1,shadowopacity=.3)");for(f=1;f<=n.lines;f++)l(f);return u(t,a)},v.prototype.opacity=function(e,t,n,r){var i=e.firstChild;r=r.shadow&&r.lines||0,i&&t+r<i.childNodes.length&&(i=i.childNodes[t+r],i=i&&i.firstChild,i=i&&i.firstChild,i&&(i.opacity=n))}):s=l(t,"animation")}(),typeof define=="function"&&define.amd?define("spin",[],function(){return v}):e.Spinner=v}(window,document),define("text!view/armory.ejs",[],function(){return'<div <%= (el) -> can.data(el, \'character\', character) %> ><a class="expandOff"><h4>Armory</h4></a>\n<div>\n<form>\n  <label for="armory_name">Name: </label><input id="armory_name" type="input" value="<%= character.attr(\'armory_name\') %>" />\n  <label for="realm">Realm: </label><input id="armory_realm" type="input" value="<%= character.attr(\'armory_realm\') %>" />\n  <label for="region">Region: </label><input id="armory_region" type="input" value="<%= character.attr(\'armory_region\') %>" />\n  <div id="armory_btn"><input type="button" value="OK" /></div>\n  <select>\n    <% can.each(past_searches, function(search) { %>\n      <option value="<%= search %>"><%= search %></option>\n    <% }) %>\n  </select>\n</form>\n</div>\n</div>'}),define("jquerypp/lang/json",["jquery"],function($){$.toJSON=function(e,t,n,r){if(typeof JSON=="object"&&JSON.stringify)return JSON.stringify(e,t,n);!r&&$.isFunction(t)&&(e=t("",e)),typeof n=="number"&&(n="          ".substring(0,n)),n=typeof n=="string"?n.substring(0,10):"";var i=typeof e;if(e===null)return"null";if(i=="undefined"||i=="function")return undefined;if(i=="number"||i=="boolean")return e+"";if(i=="string")return $.quoteString(e);if(i=="object"){if(typeof e.toJSON=="function")return $.toJSON(e.toJSON(),t,n,!0);if(e.constructor===Date){var s=e.getUTCMonth()+1;s<10&&(s="0"+s);var o=e.getUTCDate();o<10&&(o="0"+o);var u=e.getUTCFullYear(),a=e.getUTCHours();a<10&&(a="0"+a);var f=e.getUTCMinutes();f<10&&(f="0"+f);var l=e.getUTCSeconds();l<10&&(l="0"+l);var c=e.getUTCMilliseconds();return c<100&&(c="0"+c),c<10&&(c="0"+c),'"'+u+"-"+s+"-"+o+"T"+a+":"+f+":"+l+"."+c+'Z"'}var h=$.isFunction(t)?function(e,n){return t(e,n)}:function(e,t){return t},p=n?"\n":"",d=n?" ":"";if(e.constructor===Array){var v=[];for(var m=0;m<e.length;m++)v.push(($.toJSON(h(m,e[m]),t,n,!0)||"null").replace(/^/gm,n));return"["+p+v.join(","+p)+p+"]"}var g=[],y;$.isArray(t)&&(y=$.map(t,function(e){return typeof e=="string"||typeof e=="number"?e+"":null}));for(var b in e){var w,E,i=typeof b;if(y&&$.inArray(b+"",y)==-1)continue;if(i=="number")w='"'+b+'"';else{if(i!="string")continue;w=$.quoteString(b)}E=$.toJSON(h(b,e[b]),t,n,!0);if(typeof E=="undefined")continue;g.push((w+":"+d+E).replace(/^/gm,n))}return"{"+p+g.join(","+p)+p+"}"}},$.evalJSON=function(src){return typeof JSON=="object"&&JSON.parse?JSON.parse(src):eval("("+src+")")},$.secureEvalJSON=function(src){if(typeof JSON=="object"&&JSON.parse)return JSON.parse(src);var filtered=src;filtered=filtered.replace(/\\["\\\/bfnrtu]/g,"@"),filtered=filtered.replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]"),filtered=filtered.replace(/(?:^|:|,)(?:\s*\[)+/g,"");if(/^[\],:{}\s]*$/.test(filtered))return eval("("+src+")");throw new SyntaxError("Error parsing JSON, source is not valid.")},$.quoteString=function(e){return e.match(_escapeable)?'"'+e.replace(_escapeable,function(e){var t=_meta[e];return typeof t=="string"?t:(t=e.charCodeAt(),"\\u00"+Math.floor(t/16).toString(16)+(t%16).toString(16))})+'"':'"'+e+'"'};var _escapeable=/["\\\x00-\x1f\x7f-\x9f]/g,_meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};return $}),define("jquerypp/dom/cookie",["jquery","jquerypp/lang/json"],function(e){return jQuery.cookie=function(e,t,n){if(typeof t=="undefined"){var a=null;if(document.cookie&&document.cookie!=""){var f=document.cookie.split(";");for(var l=0;l<f.length;l++){var c=jQuery.trim(f[l]);if(c.substring(0,e.length+1)==e+"="){a=decodeURIComponent(c.substring(e.length+1));break}}}if(jQuery.evalJSON&&a&&a.match(/^\s*\{/))try{a=jQuery.evalJSON(a)}catch(h){}return a}n=n||{},t===null&&(t="",n.expires=-1),typeof t=="object"&&jQuery.toJSON&&(t=jQuery.toJSON(t));var r="";if(n.expires&&(typeof n.expires=="number"||n.expires.toUTCString)){var i;typeof n.expires=="number"?(i=new Date,i.setTime(i.getTime()+n.expires*24*60*60*1e3)):i=n.expires,r="; expires="+i.toUTCString()}var s=n.path?"; path="+n.path:"",o=n.domain?"; domain="+n.domain:"",u=n.secure?"; secure":"";document.cookie=[e,"=",encodeURIComponent(t),r,s,o,u].join("")},e}),define("app/util/armory",["can","spin","jquery","text!view/armory.ejs","jquerypp/dom/cookie"],function(e,t,n,r){e.view.ejs("armoryView",r);var i={lines:13,length:2,width:3,radius:4,corners:1,rotate:34,color:"#000",speed:.9,trail:50,shadow:!1,hwaccel:!1,className:"spinner",zIndex:2e9,top:"20",left:"30"},s=function(e){var t=e.split("@"),n=t[1].split("-");return{armory_name:t[0],armory_realm:n[0],armory_region:n[1]}},o=function(t){return t.armory_region=t.armory_region.toUpperCase(),e.sub("{armory_name}@{armory_realm}-{armory_region}",t)},u=e.Control({init:function(r,o){this.options.spinner=new t(i),this.options.character=new e.Observe({armory_name:"",armory_realm:"",armory_region:"US"});var u=n.cookie("armory_searches");this.options.past_searches=u==null?[]:u.split("&"),this.options.past_searches.length>0&&this.options.character.attr(s(this.options.past_searches[0])),this.element=r,this.element.html(e.view("armoryView",this.options))},'input[type="input"] change':function(e,t){this.options.character.attr(n(e).attr("id"),n(e).attr("value"))},'input[type="button"] click':function(e,t){this.readArmory()},"select change":function(e,t){this.options.character.attr(s(n(e).val()))},readArmory:function(){var t=this.options.spinner;t.spin(),n("#armory_btn").append(t.el).children("input").hide();var r=this.options.character,i=this.options.past_searches,s=this,u=e.sub("cgi-bin/armory.cgi?region={armory_region}&server={armory_realm}&character={armory_name}",r);n.getJSON(u,function(t,u,a){var f=o(r),l=i.indexOf(f);l!=-1&&i.splice(l,1),i.unshift(f),i.length>20&&i.pop(),n.cookie("armory_searches",i.join("&"));var c={5:"disc",2:"pally",11:"druid",7:"shaman",1:"monk"}[t["class"]],h={bint:Math.round(t.stats.int/1.05),bspi:t.stats.spr,bmast:t.stats.masteryRating,bcrit:t.stats.critRating,bhaste:t.stats.hasteRating,bweapon:t.stats.spellPower-t.stats.int+10};e.Observe.startBatch(),n("#filters").data("controls")[0].setSpec(c),n("div",n("#stats")).data("stat").attr(h),e.Observe.stopBatch(),s.element.html(e.view("armoryView",s.options))}).error(function(e,r,i){t.stop(),n("#armory_btn").children("input").show(),alert("There was a problem accessing armory. Armory may be down, or the character name or realm are incorrect.")})}});return u}),define("text!view/haste_bar.ejs",[],function(){return'<div class="haste_bar expand">\n  <div class="haste_current"></div>\n  <% spec.breakpoints.each(function(breakpoint) { %>\n    <div <%= (el) -> can.data(el, \'breakpoint\', breakpoint) %> class="breakpoint">\n      <%== ImageLoader.str(breakpoint.img) %>\n    </div>\n  <% }); %>\n</div>\n<div class="haste_list">\n  <table>\n  </table>\n</div>'}),define("text!view/bpoint_rows.ejs",[],function(){return"<thead>\n  <th>Tick</th><th>Spell</th><th>Haste</th><th>Rating</th><th>Relative</th>\n</thead>\n<tbody>\n<% breakpoints.each(function(breakpoint) { %>\n  <tr <%= (el) -> can.data(el, 'breakpoint', breakpoint) %> class=\"bpoint_line <%= breakpoint.rel_rating > 0 ? 'after' : '' %>\">\n    <td><%= breakpoint.no %></td><td><%= breakpoint.name %></td>\n    <td><%= Math.round((breakpoint.hastep-1) * 10000)/100 %>%</td><td><%= breakpoint.rating %></td>\n    <td><%= breakpoint.rel_rating %></td>\n  </tr>\n<% }); %>\n</tbody>"}),define("app/util/haste_bar",["can","text!view/haste_bar.ejs","text!view/bpoint_rows.ejs"],function(e,t,n){e.view.ejs("hasteBarView",t),e.view.ejs("bpointRowsView",n);var r=e.Control({init:function(t,n){var r=this,i=n.spec;r.element.html(e.view("hasteBarView",{spec:i})),r.update_bar()},"{spec} change":function(){this.update_bar()},update_bar:function(){var t=this.options.spec,n=t.fhaste_mul(),r=Math.round(t.hastep*1e3)/1e3,i=t.stats.bhaste,s=t.breakpoints,o=3e3;s.each(function(t){t.rating=Math.ceil((t.hastep/n-1)*425*100),t.rel_rating=t.rating-i,t.percent=Math.round(.5*(1+t.rel_rating/o*.9)*100)+"%",t.text=e.sub("You gain the {no} extra tick of {name} at {rating} rating.\nNeed {rel_rating} rating to reach that point.\n{hastep}",t)}),$(".breakpoint",this.element).hide().filter(function(e){var t=$(this).data("breakpoint").rel_rating;return t<o&&t>-o}).show().css("left",function(){return $(this).data("breakpoint").percent}).attr("title",function(){return $(this).data("breakpoint").text}),$(".haste_current").attr("title",e.sub("You have {haste_rat} rating.\nHaste factor: {hastep}",{haste_rat:i,hastep:r})),$("table",this.element).html(e.view("bpointRowsView",{breakpoints:s}))}});return r}),define("app/model/rotation",["can","app/model/spec","app/model/spell"],function(e,t,n){var r=e.Construct({decode:function(e){var r=e.split("&"),i={nick:decodeURIComponent(r.shift()),spec:t.find(r.shift()),results:{target_time:parseInt(r.shift().replace("time:",""))},spells:[]},s,o,u=r.length;while(u--)s=r[u].split(":"),i.spells.push({no:s[0],sp:n.find(parseInt(s[1]))});return i},encode:function(t){var n=[];return n.push(encodeURIComponent(t.nick)),n.push(t.spec.name),n.push("time:"+t.results.target_time),$.each(t.spells,function(t,r){n.push(e.sub("{no}:{sp.id}",r))}),n.join("&")},"import":function(e){return new this(this.decode(e))}},{init:function(t){this.nick=t.nick||"foo",this.spec=t.spec,this.specid=t.spec.id,this.spells=new e.Observe.List(t.spells||[]),this.results=new e.Observe({}),this.results.attr("target_time",t.results&&t.results.target_time||120),this.val_update()},contains_not:function(e){if(e.specid!==this.specid)return!1;var t=this.spells,n=t.length;while(n--)if(t[n].sp===e)return!1;return!0},add:function(e){this.spells.push({no:1,sp:e}),this.val_update()},"export":function(){return r.encode(this)},_looper:function(e,t){var n=0,r=this.spells,i;for(i=r.length;i--;)n+=r[i].no*r[i].sp[e].call(r[i].sp,t);return n},fheal:function(e){return this._looper("fheal",e)},fct:function(e){return this._looper("fct",e)},fctp:function(e){return this.fct(e)/this.results.target_time},fmana:function(e){return this._looper("fmana",e)},fhps:function(e){return this.fheal(e)/this.fct(e)},fehps:function(e){return this.fheal(e)/this.results.target_time},fhpm:function(e){return this.fheal(e)/this.fmana(e)},fmps:function(e){return this.fmana(e)/this.fct(e)},femps:function(e){return this.fmana(e)/this.results.target_time},fidle:function(e){return this.results.target_time-this.fct(e)},fidlep:function(e){return this.fidle(e)/this.results.target_time},ftoom:function(e){return this.spec.ftotal_mana(e)/Math.max(this.femps(e)-this.spec.fregen_mps(e),0)},val_update:function(e){this.results.attr({heal:Math.round(this.fheal(e)),ct:Math.round(this.fct(e)*100)/100,mana:Math.round(this.fmana(e)),hps:Math.round(this.fhps()*10)/10,ehps:Math.round(this.fehps()*10)/10,hpm:Math.round(this.fhpm()),mps:Math.round(this.fmps()*100)/100,emps:Math.round(this.femps()*100)/100,idle:Math.round(this.fidle()*100)/100,idlep:Math.round(this.fidlep()*1e3)/10,ctp:Math.round(this.fctp()*1e3)/10,toom:Math.round(this.ftoom()*10)/10})}});return r}),define("text!view/spell_lister.ejs",[],function(){return'<% can.each(rendered_spells, function(spell) { %>\n  <div class="spell_item" <%= (el) -> el.data(\'spell\', spell) %>>\n    <span class="list_left"><%= spell.name %></span>\n    <span class="list_right"><%= spell.mana %> mana</span>\n    <span class="list_right"><%= spell.ct %> secs</span>\n    <span class="list_right"><%= spell.hps %> HPS</span>\n  </div>\n<% }) %>'}),define("app/util/spell_lister",["can","jquery","app/model/spell","text!view/spell_lister.ejs"],function(e,t,n,r){e.view.ejs("spellListerView",r);var i=e.Control({init:function(e){this.options.spells=n,this.options.view="spellListerView",this.options.rendered_spells=[],this.element=e},attach:function(n,r){var i=this.options,s=i.spells,o=function(e){return r.contains_not.call(r,s[e])};this.options.rendered_spells=[],t(this.options.spells).filter(o).each(function(e,t){i.rendered_spells.push(t)}),this.options.callback=function(e){r.add.call(r,e)},t(this.element).html(e.view(this.options.view,this.options)).css({position:"absolute"}).css({top:0,left:0}).insertAfter(n).show()},".spell_item click":function(e,n){t(e).parent().hide(),this.options.callback(t(e).data("spell"))},mouseleave:function(e,n){t(e).hide()}}),s=new i(t('<div class="spell_lister"></div>'));return s}),define("text!view/rotation.ejs",[],function(){return'<div class="rotation">\n  <div class="heading expandOn">\n    <%== ImageLoader.str(rotation.spec.icon) %><a class="rotationName"><%= rotation.nick %></a>\n    <input type="button" class="btn_export_rotation" value ="Export Rotation" />\n    <input type="button" class="btn_save_rotation" value ="Save Rotation" />\n    <input type="button" class="btn_remove_rotation" value ="Remove Rotation" />\n  </div>\n  <div>\n  <input type="button" class="btn_add_spell" value ="Add Spell" /><label for="target_time">Target Time: <input type="input" class="target_time" name="target_time" value="<%= rotation.results.attr(\'target_time\') %>"/></label>\n  <table class="rotation">\n    <thead>\n      <th class="no"># Casts</th><th class="name">Spell</th><th class="result">Total Mana</th><th class="result">Total Time</th><th class="result">Overall Healing</th>\n    </thead>\n    <tbody>\n    <% rotation.spells.each(function(spell) { %>\n      <tr <%= (el) -> can.data(el, \'spell\', spell)%>>\n        <td><input type="input" value="<%= spell.attr(\'no\') %>" /></td><td><%= spell.sp.name %><a class="destroy">x</a></td>\n        <td><%= Math.round(spell.attr(\'no\') * spell.attr(\'sp.mana\')) %></td>\n        <td><%= Math.round(spell.attr(\'no\') * spell.attr(\'sp.ct\') *100)/100 %></td>\n        <td><%= Math.round(spell.attr(\'no\') * spell.attr(\'sp.heal\')*10)/10 %></td>\n      </tr>\n    <%})%>\n    <tr class="totals"><td></td><td>Rotation Totals</td><td><%= rotation.results.attr(\'mana\') %></td><td><%= rotation.results.attr(\'ct\') %></td>\n              <td><%= rotation.results.attr(\'heal\') %></td></tr>\n    <tr class="totals"><td></td><td></td><td>HPS: <%= rotation.results.attr(\'hps\') %></td><td>HPM: <%= rotation.results.attr(\'hpm\') %></td>\n            <td>MPS: <%= rotation.results.attr(\'mps\') %></td></tr>\n    </tbody>\n  </table>\n  </div>\n</div>'}),define("app/control/rotation",["can","jquery","app/model/rotation","app/util/spell_lister","app/model/spec","text!view/rotation.ejs"],function(e,t,n,r,i,s){e.view.ejs("rotationView",s);var o=e.Control({init:function(t,i){this.element=t,this.options={},this.options.lister=r,this.options.rotation=i.hasOwnProperty("str")?n.import(i.str):new n(i),this.element.data("rotation",this.options.rotation),this.element.html(e.view("rotationView",this.options))},"input.btn_add_spell click":function(e,t){var n=this.options.rotation;this.options.lister.attach(e,n)},".rotation input change":function(e,n){var r=t(e).closest("tr").data("spell");r.attr("no",parseInt(t(e).val())),this.options.rotation.val_update()},".destroy click":function(e,n){var r=t(e).closest("tr").data("spell"),i=this.options.rotation.spells,s=i.indexOf(r);i.splice(s,1)},"input.target_time change":function(e,n){this.options.rotation.results.attr("target_time",parseInt(t(e).val())),this.options.rotation.val_update()},".btn_export_rotation click":function(e,t){t.stopImmediatePropagation(),prompt('The following string represents your rotation. Use it with "Import  Rotation:"',this.options.rotation.export())}});return o}),define("text!view/rotation_storage.ejs",[],function(){return'<ul>\n<% can.each(storage, function(rotation) { %>\n<li class="rotation_st" <%= (el) -> can.data(el, \'rotation\', rotation) %>>\n  <%== ImageLoader.str(rotation.spec.icon) %>\n  <span class="rotation_name"><%= rotation.nick %></span><a class="destroy">x</a></li>\n<% }) %>\n</ul>\n'}),define("app/util/rotation_storage",["can","jquery","app/model/rotation","text!view/rotation_storage.ejs"],function(e,t,n,r){e.view.ejs("rotationStorageView",r);var i=e.Control({init:function(r,i){this.element=r;var s=localStorage.rotations;this.options.storage=new e.Observe.List(t.map(s?s.split("|"):[],function(e){return n.decode(e)})),this.element.html(e.view("rotationStorageView",this.options))},save:function(){return localStorage.rotations=t.map(this.options.storage,function(e){return n.encode(e)}).join("|"),this},indexOf:function(e){var t=this.options.storage,n=t.length;while(n--)if(t[n].nick===e.nick&&t[n].spec.name===e.spec.name)return n;return-1},update_rotation:function(e){var t=this.options.storage,n=this.indexOf(e);return n===-1?t.push(e):t[n]=e,this.save()},"li click":function(e,n){t(this).trigger("load_rotation",e.closest("li").data("rotation")),this.element.hide()},mouseleave:function(e,t){this.element.hide()},".destroy click":function(e,t){t.stopImmediatePropagation();var n=this.options.storage,r=e.closest("li").data("rotation"),i=n.indexOf(r);n.splice(i,1),this.save()}});return i}),define("text!view/rotations.ejs",[],function(){return"<div><a class=\"expandOff\"><h4>Rotations</h4></a>\n<div>\n  <input type=\"button\" id=\"btn_new_rotation\" value=\"New Rotation\" />\n  <input type=\"button\" id=\"btn_load_rotation\" value=\"Load Rotation\" style=\"position: relative\" />\n  <div id=\"rotation_storage\" style=\"position: absolute\" <%= (el) -> el.hide() %>></div>\n  <input type=\"button\" id=\"btn_import_rotation\" value=\"Import Rotation\" />\n  <div id=\"new_rotation\" <%= (el) -> $(el).hide(); %> ><label for=\"rotation_name\">Name:</label><input name=\"rotation_name\" type=\"input\" />\n  <select>\n    <% specs.each(function(spec) { %>\n      <option value=\"<%= spec.id %>\"><%= spec.name %></option>\n    <% })%>\n  </select>\n  <input type=\"button\" id=\"btn_create\" value=\"Create!\" />\n  </div>\n  <table id=\"rotations_comparison\">\n    <thead>\n      <tr><th>Spec</th><th>Name</th><th>HPS</th><th>Eff. HPS</th><th>HPM</th><th>MPS</th><th>Eff. MPS</th>\n      <th>Target Time</th><th>Cast Time</th><th>Idle Time</th>\n      <th>Time to OOM</th>\n      </tr>\n    </thead>\n    <tbody>\n      <% rotations.each(function(rotation) { %>\n        <tr <%= (el) -> can.data(el, 'rotation', rotation) %>>\n          <td><%== ImageLoader.str(rotation.spec.icon) %></td>\n          <td><%= rotation.nick %></td>\n          <td <%= (el) -> can.data(el, 'colinfo', {fun: 'fhps', name: 'HPS'}) %>><%= rotation.results.attr('hps') %></td>\n          <td <%= (el) -> can.data(el, 'colinfo', {fun: 'fehps', name: 'Eff. HPS'}) %>><%= rotation.results.attr('ehps') %></td>\n          <td <%= (el) -> can.data(el, 'colinfo', {fun: 'fhpm', name: 'HPM'}) %>><%= rotation.results.attr('hpm') %></td>\n          <td <%= (el) -> can.data(el, 'colinfo', {fun: 'fmps', name: 'MPS'}) %>><%= rotation.results.attr('mps') %></td>\n          <td <%= (el) -> can.data(el, 'colinfo', {fun: 'femps', name: 'Eff. MPS'}) %>><%= rotation.results.attr('emps') %></td>\n          <td><%= rotation.results.attr('target_time') %></td>\n          <td><%= rotation.results.attr('ct') %> (<%= rotation.results.attr('ctp') %>%)</td>\n          <td><%= rotation.results.attr('idle') %> (<%= rotation.results.attr('idlep') %>%)</td>\n          <td <%= (el) -> can.data(el, 'colinfo', {fun: 'ftoom', name: 'Time to OOM'}) %>><%= rotation.results.attr('toom') %></td>\n        </tr>\n      <% }) %>\n    </tbody>\n  </table>\n  <ul id=\"rotations_list\">\n    <!-- Rotation sections (copies of rotation.ejs) will go here -->\n  </ul>\n</div>\n\n</div>\n"}),define("app/control/rotations",["can","jquery","app/control/rotation","app/model/spec","app/util/rotation_storage","text!view/rotations.ejs"],function(e,t,n,r,i,s){e.view.ejs("rotationsView",s);var o=e.Control({init:function(n,r){var s=this;s.element=n,s.options=r,s.options.rotations=new e.Observe.List,s.element.append(e.view("rotationsView",s.options)),s.options.rotation_storage=new i("#rotation_storage"),t(s.options.rotation_storage).bind("load_rotation",function(e,t){s.add_rotation(t)});return},"#btn_new_rotation click":function(e,n){t("#new_rotation").show()},add_rotation:function(e){var r=t('<li style="position: relative"></li>').appendTo(t("ul#rotations_list",this.element));return this.options.rotations.push((new n(r,e)).options.rotation),this},"#btn_create click":function(e,n){var r=t(e).siblings("select").val(),i={nick:t(e).siblings("input[type=input]").val(),spec:this.options.specs[r-1]};this.add_rotation(i),t(e).parent().hide()},"#btn_import_rotation click":function(){var e=(prompt("Please paste the exported rotation string:","")||"").trim();if(e==="")return!1;this.add_rotation({str:e})},".btn_remove_rotation click":function(e,n){var r=t(e).closest("li"),i=r.data("rotation"),s=this.options.rotations,o=s.indexOf(i);s.splice(o,1),r.remove()},"#btn_load_rotation click":function(e,n){t("#rotation_storage").toggle()},".btn_save_rotation click":function(e,n){n.stopImmediatePropagation(),this.options.rotation_storage.update_rotation(t(e).closest("li").data("rotation"))},"{specs} change":function(){t("ul#rotations_list li",this.element).each(function(e,n){t(n).data("rotation").val_update()})}});return o}),define("app/setup",["jquery","can","app/model/stat","app/control/stats","app/model/buff","app/control/buffs","app/model/spec","app/control/specs","app/model/spell","app/control/spells","app/util/filtering","app/util/delta_viewer","app/util/armory","app/util/haste_bar","app/control/rotations","app/util/image_loader"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v){e(document).ready(function(){t.EJS.Helpers.prototype.ImageLoader=v,new r("#stats",{stats:n}),new s("#buffs",{buffs:i}),new u("#specs",{specs:o,stats:n,buffs:i}),new f("#spells",{spells:a,specs:o}),new l("#filters",{table:e("#spellTable"),specs:e("#specs")}),new c("#deltaView",{source:e("body")}),new h("#armory"),o.each(function(e){var t="haste_bar_"+e.name;new p("#"+t,{spec:e})}),new d("#rotations",{specs:o})});return}),requirejs.config({baseUrl:"js/lib",paths:{app:"../app",jquery:"jquery-1.8.3.min",view:"../app/view"}}),requirejs(["jquery","can/view/ejs","can/control","app/model/stat","app/control/stats","app/model/buff","app/control/buffs","app/setup"],function(e,t,n,r,i,s,o){e(document).ready(function(){var t=function(t,n){e(this).toggleClass("expandOff expandOn").siblings("div").toggle()};e("body").delegate(".expandOff, .expandOn","click",t),e(".expandOff").siblings("div").hide()})}),define("app/main",function(){});